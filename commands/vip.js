const User = require("../models/User");
const Progress = require("../models/Progress");
const { sendLongMessage } = require("../utils/message-splitter");
const celebrations = require("../services/celebrations");

// Enhanced VIP tracking with comprehensive analytics
let vipSpots = {
  total: 20,
  used: 3,
  waitlist: 0,
  remaining: function () {
    return this.total - this.used;
  },
  conversionRate: function () {
    return ((this.used / (this.used + 10)) * 100).toFixed(1);
  }, // Assuming 10 total inquiries
  reset: function () {
    this.used = 0;
    this.waitlist = 0;
  },
};

// Enhanced analytics tracking
const analytics = {
  vipFunnel: {
    infoViews: 0,
    applications: 0,
    conversions: 0,
    qualificationCalls: 0,
    capitalClarityInquiries: 0,
  },
  updateFunnel: function (stage) {
    if (this.vipFunnel[stage] !== undefined) {
      this.vipFunnel[stage]++;
    }
  },
  getConversionRate: function () {
    return this.vipFunnel.infoViews > 0
      ? ((this.vipFunnel.conversions / this.vipFunnel.infoViews) * 100).toFixed(
          1,
        )
      : 0;
  },
};

// Input validation helper
function validateInput(msg, bot) {
  if (!msg || !msg.from || !msg.from.id || !bot) {
    console.error("Critical validation error: Missing required parameters");
    return false;
  }
  return true;
}

// Enhanced error handling wrapper
async function executeWithErrorHandling(operation, context, fallbackMessage) {
  try {
    return await operation();
  } catch (error) {
    console.error(`Error in ${context}:`, error);

    try {
      if (fallbackMessage.bot && fallbackMessage.chatId) {
        await fallbackMessage.bot.sendMessage(
          fallbackMessage.chatId,
          fallbackMessage.message ||
            "áŸá¼á˜á¢á—áŸá™á‘áŸ„áŸ! á˜á¶á“á”á‰áŸ’á á¶á”á…áŸ’á…áŸá€á‘áŸáŸáŸ” áŸá¼á˜á–áŸ’á™á¶á™á¶á˜á˜áŸ’áá„á‘áŸ€ááŸ”",
        );
      }
    } catch (sendError) {
      console.error(`Failed to send error message in ${context}:`, sendError);
    }

    return null;
  }
}

async function info(msg, bot) {
  if (!validateInput(msg, bot)) return;

  const userId = msg.from.id;
  const chatId = msg.chat.id;

  return executeWithErrorHandling(
    async () => {
      // Enhanced analytics tracking
      analytics.updateFunnel("infoViews");
      console.log(`VIP info viewed by user ${userId} at ${new Date()}`);

      // Enhanced user tracking with qualification scoring
      await User.findOneAndUpdate(
        { telegram_id: userId  },
        {
          lastVipInfoView: new Date(),
          last_active: new Date(),
          $inc: {
            vipInfoViewCount: 1,
            totalEngagementScore: 2, // Info view = 2 points
          },
          $setOnInsert: {
            vipQualificationScore: 0,
            vipJourneyStage: "awareness",
          },
        },
        { upsert: true },
      );

      const vipMessage = `ğŸ† VIP Capital Strategy - $197 (áŸ¦áŸ % áá˜áŸ’á›áŸƒá–á·áŸáŸáŸ)

ğŸ¯ á€á¶ášá¢á—á·áœáŒáŸ’áá˜á¼á›áŠáŸ’á‹á¶á“á‚áŸ’ášá¹áŸ‡á˜á¼á›á’á“:
âœ… á–á·á“á·ááŸ’á™áŸáŸ’áá¶á“á—á¶á–á˜á¼á›á’á“á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“
âœ… áœá¶á™áá˜áŸ’á›áŸƒá€á¶ášááŸ’ášáŸ€á˜ááŸ’á›á½á“áŸá˜áŸ’ášá¶á”áŸ‹á€á¶ášáœá·á“á·á™áŸ„á‚á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹
âœ… á”á„áŸ’á€á¾áá˜á¼á›áŠáŸ’á‹á¶á“áŸá˜áŸ’ášá¶á”áŸ‹á€á¶ášáœá·á“á·á™áŸ„á‚á¯á€á‡á“
âœ… ááŸ’ášáŸ€á˜ááŸ’á›á½á“áŸá˜áŸ’ášá¶á”áŸ‹á€á¶ášá¢á—á·áœáŒáŸ’áá“áŸá–á¶áá·á‡áŸ’á‡á€á˜áŸ’á˜
âœ… ášáŸ€á”á…áŸ†á•áŸ‚á“á€á¶ášá‘á¶á€áŸ‹á‘á¶á‰áœá·á“á·á™áŸ„á‚á·á“
âœ… á€á¶ášááŸ‚á“á¶áŸ†á”ááŸ’áá¶á‰áœá·á“á·á™áŸ„á‚á·á“á‡á¶á€áŸ‹á›á¶á€áŸ‹

ğŸ›ï¸ áœá‚áŸ’á‚á”ááŸ’áá»áŸ‡á”ááŸ’áá¶á›á˜á¼á›á’á“ (áŸ©áŸ  á“á¶á‘á¸):
â€¢ Opening Frame - á€á¶ášá€áŸ†áááŸ‹á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá‡á¶á€áŸ‹á›á¶á€áŸ‹
â€¢ Capital X-Ray - á€á¶ášáœá·á—á¶á‚ášá…á“á¶áŸá˜áŸ’á–áŸá“áŸ’á’á˜á¼á›á’á“á–áŸá‰á›áŸá‰
â€¢ Trust Mapping - á€á¶ášáœá¶á™áá˜áŸ’á›áŸƒá‘áŸ†á“á»á€á…á·ááŸ’ááœá·á“á·á™áŸ„á‚á·á“
â€¢ System Readiness Score - á€á¶ášáœá¶á™áá˜áŸ’á›áŸƒá—á¶á–ááŸ’ášáŸ€á˜ááŸ’á›á½á“
â€¢ Clarity Prescription - á•áŸ‚á“á€á¶ášá™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’áš áŸ£áŸ -áŸ©áŸ  ááŸ’á„áŸƒ

ğŸ‡°ğŸ‡­ á”á‘á–á·áŸáŸ„á’á“áŸáŸá˜á¶á‡á·á€ VIP:
ğŸ‘¤ "á”á¶á“á‡á½á™á”á‰áŸ’á‡á¶á€áŸ‹áœá·á’á¸áŸá¶áŸáŸ’ášáŸ’áá•áŸ’áá›áŸ‹á˜á¼á›á“á·á’á·ášá”áŸáŸ‹ááŸ’á‰á»áŸ†" - Tech Startup, á—áŸ’á“áŸ†á–áŸá‰
ğŸ‘¤ "á™á›áŸ‹áŠá¹á„á€á¶á“áŸ‹ááŸ‚á…áŸ’á”á¶áŸáŸ‹á¢áŸ†á–á¸á”áŸ’ášá–áŸá“áŸ’á’á›áŸ†á á¼ášáŸá¶á…áŸ‹á”áŸ’ášá¶á€áŸ‹" - á˜áŸ’á…á¶áŸáŸ‹á—áŸ„á‡á“á¸á™áŠáŸ’á‹á¶á“, áŸáŸ€á˜ášá¶á”
ğŸ‘¤ "á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„á”ááŸ’áá¶á‰áœá·á“á·á™áŸ„á‚á·á“áŠáŸá˜á¶á“áá˜áŸ’á›áŸƒ" - E-commerce, á”á¶ááŸ‹áŠáŸ†á”á„
ğŸ‘¤ "á‡áŸ†á“á¶á‰á’áŸ’áœá¾á”á‘á”á„áŸ’á á¶á‰á¢á¶á‡á¸áœá€á˜áŸ’á˜á”áŸ’ášáŸá¾ášá¡á¾á„" - Manufacturing, á€áŸ†á–á„áŸ‹á…á¶á˜

âœ… á€á‰áŸ’á…á”áŸ‹ VIP á–áŸá‰á›áŸá‰ášá½á˜á”á‰áŸ’á…á¼á›:
â€¢ á˜á¶á“á‘á¶áŸ†á„á¢áŸáŸ‹á–á¸ Premium Program
â€¢ á€á¶ášá‚á¶áŸ†á‘áŸ’ášá€á¶ášá¢á“á»áœááŸ’áášá™áŸˆá–áŸá› áŸ£áŸ  ááŸ’á„áŸƒ
â€¢ á€á¶ášá…á¼á›á”áŸ’ášá¾á”ááŸ’áá¶á‰á˜á¼á›á’á“á¯á€á‡á“ (áœá·á“á·á™áŸ„á‚á·á“á€á˜áŸ’á–á»á‡á¶ áŸ¡áŸ áŸ + á“á¶á€áŸ‹)
â€¢ á€á¶ášá‚á¶áŸ†á‘áŸ’ášá¢á¶á‘á·á—á¶á– VIP (á†áŸ’á›á¾á™áá”á›á¿á“á‡á¶á„á’á˜áŸ’á˜áá¶ á€áŸ’á“á»á„ášá™áŸˆá–áŸá› áŸ¢-áŸ¤ á˜áŸ‰áŸ„á„)
â€¢ áœá‚áŸ’á‚á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’áš áŸ¡-á‘á›áŸ‹-áŸ¡ á…áŸ†á“á½á“ áŸ£ áŠá„ (áá˜áŸ’á›áŸƒ $300)
â€¢ á€á¶ášá…á¼á›á”áŸ’ášá¾ Deal Flow á•áŸ’áá¶á…áŸ‹á˜á»á
â€¢ á§á”á€ášááŸá”á„áŸ’á€á¾á“á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–á˜á¼á›á’á“á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹
â€¢ á€á¶ášá…á¼á›á”áŸ’ášá¾áŸá á‚á˜á“áŸ VIP (áŸá á‚áŸ’ášá·á“á‡áŸ„á‚á‡áŸá™)

ğŸ’¼ áŸá˜áŸáŸ’ášá”áŸá˜áŸ’ášá¶á”áŸ‹:
- á¢áŸ’á“á€á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„áŠáŸ‚á›á˜á¶á“á˜á¼á›á’á“á’áŸ† ($10K+ á…áŸ†áá¼á›á”áŸ’ášá…á¶áŸ†ááŸ‚)
- á˜áŸ’á…á¶áŸáŸ‹á¢á¶á‡á¸áœá€á˜áŸ’á˜á…á„áŸ‹áŸáŸ’áœáŸ‚á„ášá€á˜á¼á›á“á·á’á· (á‚áŸ„á›áŠáŸ… $50K+)
- á–á¶áá·á‡áŸ’á‡á€ášáŠáŸ‚á›á€áŸ†á–á»á„á¢á—á·áœáŒáŸ’áá“áŸá”áŸ’ášá–áŸá“áŸ’á’á’á“á¶á‚á¶áš/á á·ášá‰áŸ’á‰áœááŸ’áá»
- á¢áŸ’á“á€á¢á¶á‡á¸áœá€á˜áŸ’á˜á…á„áŸ‹á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á˜á¼á›á’á“á”áŸ’ášá€á”áŠáŸ„á™á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–

ğŸ¯ á¢ááŸ’áá”áŸ’ášá™áŸ„á‡á“áŸá”ááŸ’áá¶á‰ VIP:
â€¢ á€á¶ášá…á¼á›á”áŸ’ášá¾á±á€á¶áŸáœá·á“á·á™áŸ„á‚á•áŸ’áá¶á…áŸ‹á˜á»á
â€¢ á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„á•áŸ’á‘á¶á›áŸ‹á‡á¶á˜á½á™á”ááŸ’áá¶á‰á˜á¼á›á’á“á¯á€á‡á“á“áŸ…á€á˜áŸ’á–á»á‡á¶
â€¢ á€á˜áŸ’á˜áœá·á’á¸áá˜áŸ’á›áŸƒááŸ’á–áŸáŸ‹áŠáŸ‚á›á¢á‰áŸ’á‡á¾á‰ááŸ‚á”áŸ‰á»ááŸ’ááŸ„áŸ‡
â€¢ á€á¶ášá…á¼á›á”áŸ’ášá¾á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹ (áŠáŸ„á™á€á¶ášáœá¶á™áá˜áŸ’á›áŸƒá‚á»ááœá»áŒáŸ’áá·ááŸ‚á”áŸ‰á»ááŸ’ááŸ„áŸ‡)
â€¢ á€á¶ášá”á„áŸ’á€á¾á“á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„á‡á¶á˜á½á™ ABA/ACLEDA/Prince Bank

ğŸ’° á€á¶ášáœá·á“á·á™áŸ„á‚: $197 (áá˜áŸ’á›áŸƒá’á˜áŸ’á˜áá¶: $497 - áŸá“áŸ’áŸáŸ†á”á¶á“ $300!)
â° á–áŸá›áœáŸá›á¶á˜á¶á“á€áŸ†áááŸ‹: á“áŸ…áŸá›áŸ‹ áŸ£áŸ¦ á˜áŸ‰áŸ„á„!
ğŸ‘¥ á€áŸ…á¢á¸ VIP: á“áŸ…áŸá›áŸ‹ ${vipSpots.remaining()} á“á¶á€áŸ‹ (áŸášá»á” ${vipSpots.total} á“á¶á€áŸ‹/ááŸ‚)
ğŸ“Š á˜áá·á€áŸ‚á›á˜áŸ’á¢á–á¸áŸá˜á¶á‡á·á€: á“á·áŸáŸ’áŸá·á VIP á—á¶á‚á…áŸ’ášá¾á“ášá¶á™á€á¶ášááŸá–á¸á€á¶ášá‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á˜á¼á›á’á“á”áŸ’ášáŸá¾ášá¡á¾á„

ğŸ BONUS á•áŸ’áá¶á…áŸ‹á˜á»á:
â€¢ á€á¶ášáœá¶á™áá˜áŸ’á›áŸƒá˜á¼á›á’á“áŠáŸ„á™á¥áá‚á·áááŸ’á›áŸƒ (áá˜áŸ’á›áŸƒ $97)
â€¢ á€á¶ášááŸ‚á“á¶áŸ†á”ááŸ’áá¶á‰áœá·á“á·á™áŸ„á‚á·á“á¯á€á‡á“
â€¢ á€á¶ášá‚á¶áŸ†á‘áŸ’áš VIP ášá™áŸˆá–áŸá› áŸ¦ ááŸ‚ (á’áŸ€á”á“á¹á„áŸáŸ’áá„áŸ‹áŠá¶áš áŸ£ ááŸ‚)
â€¢ á€á¶ášá…á¼á›á”áŸ’ášá¾á±á€á¶áŸá¢á¶á‡á¸áœá€á˜áŸ’á˜á•áŸ’áá¶á…áŸ‹á˜á»ááŸá˜áŸ’ášá¶á”áŸ‹ VIP á“áŸ…á€á˜áŸ’á–á»á‡á¶

ğŸ¯ ááŸ’ášáŸ€á˜ááŸ’á›á½á“ášá½á…ášá¶á›áŸ‹áŸá˜áŸ’ášá¶á”áŸ‹ VIP Capital Strategy?
á…á„áŸ‹á…á¼á›ášá½á˜? áŸášáŸáŸáš "VIP APPLY"

âš ï¸ á“áŸáŸ‡á‡á¶á€á˜áŸ’á˜áœá·á’á¸áœá·á“á·á™áŸ„á‚á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹áŸá˜áŸ’ášá¶á”áŸ‹á˜áŸ’á…á¶áŸáŸ‹á¢á¶á‡á¸áœá€á˜áŸ’á˜á’áŸ’á„á“áŸ‹á’áŸ’á„ášááŸ‚á”áŸ‰á»ááŸ’ááŸ„áŸ‡áŸ”`;

      await sendLongMessage(bot, chatId, vipMessage, {}, MESSAGE_CHUNK_SIZE);

      // Enhanced success analytics
      console.log(
        `VIP info sent successfully to user ${userId}. Total views: ${analytics.vipFunnel.infoViews}`,
      );
    },
    "VIP info",
    { bot, chatId },
  );
}

async function apply(msg, bot) {
  if (!validateInput(msg, bot)) return;

  const userId = msg.from.id;
  const chatId = msg.chat.id;

  return executeWithErrorHandling(
    async () => {
      // Enhanced analytics tracking
      analytics.updateFunnel("applications");
      console.log(`VIP application started by user ${userId} at ${new Date()}`);

      // Enhanced qualification check
      const progress = await Progress.findOne({ user_id: userId });
      if (!progress || !progress.programCompleted) {
        await bot.sendMessage(
          chatId,
          `ğŸš¨ á›á€áŸ’ááááŸ’áŒáá˜áŸ’ášá¼áœ: áŸá¼á˜á”á‰áŸ’á…á”áŸ‹á€á˜áŸ’á˜áœá·á’á¸ 7-Day Reset á˜á»á“á“á¹á„á…á¼á›ášá½á˜ VIP ProgramáŸ”

á…á»á… /progress áŠá¾á˜áŸ’á”á¸á˜á¾á›áœáŒáŸ’áá“á—á¶á–
á…á»á… /start áŠá¾á˜áŸ’á”á¸á…á¶á”áŸ‹á•áŸ’áá¾á˜ 7-Day Program

ğŸ’¡ VIP Program ááŸ’ášá¼áœá€á¶ášá…áŸ†ááŸáŸ‡áŠá¹á„á˜á¼á›áŠáŸ’á‹á¶á“á–á¸á€á˜áŸ’á˜áœá·á’á¸á˜áŸáŸ”`,
        );
        return;
      }

      // Enhanced spot availability check
      if (vipSpots.remaining() <= 0) {
        vipSpots.waitlist++;
        await User.findOneAndUpdate(
          { telegram_id: userId  },
          {
            vipWaitlistJoined: new Date(),
            vipJourneyStage: "waitlist",
          },
        );

        await bot.sendMessage(
          chatId,
          `ğŸš¨ VIP Program á”á¶á“á–áŸá‰áŸá˜áŸ’ášá¶á”áŸ‹ááŸ‚á“áŸáŸ‡!

ğŸ‘¥ á‘á¸áá¶áŸ†á„á€áŸ’á“á»á„á”á‰áŸ’á‡á¸ášá„áŸ‹á…á¶áŸ†: #${vipSpots.waitlist}
ğŸ“… á¢á¶á…á…á¼á›ášá½á˜á”á¶á“á”á“áŸ’á‘á¶á”áŸ‹: ááŸ‚á€áŸ’ášáŸ„á™
ğŸ”” á€á¶ášá‡á¼á“áŠáŸ†áá¹á„áŠáŸ„á™áŸáŸ’áœáŸá™á”áŸ’ášáœááŸ’áá·: á“áŸ…á–áŸá›á˜á¶á“á€áŸ…á¢á¸á‘áŸ†á“áŸáš

á…á»á… /vip_waitlist áŸá˜áŸ’ášá¶á”áŸ‹á¢á¶á‘á·á—á¶á–á‡á¼á“áŠáŸ†áá¹á„
á…á»á… /capital_clarity áŸá˜áŸ’ášá¶á”áŸ‹á‡á˜áŸ’ášá¾áŸáœá‚áŸ’á‚á¯á€á‡á“`,
        );
        return;
      }

      // Enhanced user tracking with qualification scoring
      await User.findOneAndUpdate(
        { telegram_id: userId  },
        {
          vipApplicationStarted: new Date(),
          last_active: new Date(),
          vipJourneyStage: "application",
          $inc: {
            vipApplicationAttempts: 1,
            totalEngagementScore: 5, // Application start = 5 points
            vipQualificationScore: 10, // Base qualification points
          },
        },
        { upsert: true },
      );

      const applicationMessage = `ğŸ† VIP Capital Strategy Application

ğŸ¯ áŸáŸ’áá¶á“á—á¶á–á¢á¶á‘á·á—á¶á–: á“áŸ…áŸá›áŸ‹ ${vipSpots.remaining()} á€áŸ…á¢á¸

ğŸ“‹ á›á€áŸ’ááááŸ’áŒáŠá¶á€áŸ‹á–á¶á€áŸ’á™ (á†áŸ’á›á¾á™á‘á¶áŸ†á„á¢áŸáŸ‹á€áŸ’á“á»á„áŸá¶ášááŸ‚á˜á½á™):

áŸ¡. á”áŸ’ášáœááŸ’áá·á¢á¶á‡á¸áœá€á˜áŸ’á˜:
â€¢ áˆáŸ’á˜áŸ„áŸ‡á€áŸ’ášá»á˜á áŸŠá»á“ á“á·á„áá½á“á¶á‘á¸ášá”áŸáŸ‹á¢áŸ’á“á€
â€¢ á…áŸ†áá¼á›á”áŸ’ášá…á¶áŸ†ááŸ‚: $1K-5K / $5K-15K / $15K-50K / $50K+
â€¢ á”áŸ’ášá—áŸá‘á¢á¶á‡á¸áœá€á˜áŸ’á˜ (á”á…áŸ’á…áŸá€áœá·á‘áŸ’á™á¶/á›á€áŸ‹ášá¶á™/áŸáŸáœá¶á€á˜áŸ’á˜/á•á›á·áá€á˜áŸ’á˜/á•áŸ’áŸáŸá„áŸ—)

áŸ¢. á‚áŸ„á›á”áŸ†áá„á˜á¼á›á’á“ (á‡á¶á€áŸ‹á›á¶á€áŸ‹):
â€¢ á…áŸ†á“á½á“á‘á¹á€á”áŸ’ášá¶á€áŸ‹á‚áŸ„á›áŠáŸ…áŠáŸ‚á›ááŸ’ášá¼áœá€á¶áš: $xx,xxx
â€¢ ášá™áŸˆá–áŸá›: áŸ£áŸ /áŸ¦áŸ /áŸ©áŸ  ááŸ’á„áŸƒ
â€¢ á‚áŸ„á›á”áŸ†áá„: á€á¶ášá–á„áŸ’ášá¸á€/á§á”á€ášááŸ/áŠá¾á˜á‘á»á“á”á„áŸ’áœá·á›/á¢á¶á‡á¸áœá€á˜áŸ’á˜ááŸ’á˜á¸
â€¢ ROI áŠáŸ‚á›ášáŸ†á–á¹á„á‘á»á€: xx% á€áŸ’á“á»á„ xx ááŸ‚

áŸ£. á”á‰áŸ’á á¶á”áŸ’ášáˆá˜á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“:
â€¢ á”á‰áŸ’á á¶á”áŸ’ášáˆá˜á€áŸ’á“á»á„á€á¶ášá‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á˜á¼á›á’á“áŠáŸ‚á›á¢áŸ’á“á€á€áŸ†á–á»á„á‡á½á”
â€¢ á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„á’á“á¶á‚á¶ášá”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“ (á€á¶ášá•áŸ’áá›áŸ‹á”áŸ’ášá¶á€áŸ‹á€á˜áŸ’á…á¸á¯á€á‡á“/á’á“á¶á‚á¶ášá”áŸ’ášá–áŸƒáá¸/á‘á¶áŸ†á„á–á¸áš)
â€¢ á€á¶ášá”áŸ‰á»á“á”áŸ‰á„áŸáŸ’áœáŸ‚á„ášá€á˜á¼á›á“á·á’á·á–á¸á˜á»á“ (á‡áŸ„á‚á‡áŸá™/á”ášá¶á‡áŸá™)
â€¢ á…áŸ†áá¶á”áŸ‹á¢á¶ášá˜áŸ’á˜ááŸá›á¾áŠáŸ†ááŸ„áŸ‡áŸáŸ’ášá¶á™á€á¶ášá•áŸ’áá›áŸ‹á”áŸ’ášá¶á€áŸ‹á€á˜áŸ’á…á¸á¯á€á‡á“á’áŸ€á”á“á¹á„á á·ášá‰áŸ’á‰áœááŸ’áá»á”áŸ’ášá–áŸƒáá¸

áŸ¤. á€á¶ášá”áŸ’ááŸá‡áŸ’á‰á¶á…á·ááŸ’ááœá·á“á·á™áŸ„á‚:
â€¢ áá¾áá˜áŸ’á›áŸƒ $197 áŸá˜áŸáŸ’ášá”á“á¹á„á€á¶ášáœá·á“á·á™áŸ„á‚áŠá¾á˜áŸ’á”á¸á¢á“á¶á‚áášá”áŸáŸ‹á¢áŸ’á“á€áŠáŸ‚ášá¬á‘áŸ?
â€¢ áœá·á’á¸á‘á¼á‘á¶ááŸ‹áŠáŸ‚á›á–áŸá‰á…á·ááŸ’á: ABA/ACLEDA/Wing/á€á¶ášá•áŸ’á‘áŸášá¯á€á‡á“
â€¢ áá¾ááŸ’ášáŸ€á˜ááŸ’á›á½á“áŸá˜áŸ’ášá¶á”áŸ‹ Advanced Capital Strategy á á¾á™á¬á“áŸ…?

áŸ¥. á–áŸá›áœáŸá›á¶áŠáŸ‚á›á¢á¶á…ášá€á”á¶á“:
â€¢ áá¾á¢áŸ’á“á€á˜á¶á“á–áŸá›áœáŸá›á¶á”áŸ’ášá…á¶áŸ†áŸá”áŸ’áá¶á áŸ áŸ¥-áŸ§ á˜áŸ‰áŸ„á„áŸá˜áŸ’ášá¶á”áŸ‹á€á˜áŸ’á˜áœá·á’á¸á“áŸáŸ‡á‘áŸ?
â€¢ á–áŸá›áœáŸá›á¶áœá‚áŸ’á‚áŠáŸ‚á›á–áŸá‰á…á·ááŸ’á: á–áŸá›á–áŸ’ášá¹á€/á–áŸá›ášáŸáŸ€á›/á–áŸá›á›áŸ’á„á¶á…
â€¢ áá¾ááŸ’ášáŸ€á˜ááŸ’á›á½á“áŸá˜áŸ’ášá¶á”áŸ‹áœá‚áŸ’á‚ áŸ¡-á‘á›áŸ‹-áŸ¡ á…áŸ†á“á½á“ áŸ£ áŠá„ á“á·á„á€á¶ášá¢á“á»áœááŸ’áá”áŸ’ášá…á¶áŸ†ááŸ’á„áŸƒá á¾á™á¬á“áŸ…?

áŸ¦. á—áŸáŸ’áá»áá¶á„á‚á»ááœá»áŒáŸ’áá·:
â€¢ á˜á¼á›á áŸáá»á¢áŸ’áœá¸áŠáŸ‚á›á’áŸ’áœá¾á±áŸ’á™á¢áŸ’á“á€áŸáŸá€áŸ’áá·áŸá˜áŸá˜áŸ’ášá¶á”áŸ‹ VIP Capital Strategy?
â€¢ á˜á¼á›á’á“á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“áŠáŸ‚á›á€áŸ†á–á»á„á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„: $xx,xxx
â€¢ áŸáŸ’áá¶á“á—á¶á–á…á»áŸ‡á”á‰áŸ’á‡á¸á¢á¶á‡á¸áœá€á˜áŸ’á˜ á“á·á„á€á¶ášá¢á“á»á›áŸ„á˜á–á“áŸ’á’
â€¢ á–áŸááŸŒá˜á¶á“á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„: á¢áŸŠá¸á˜áŸ‚á› á“á·á„á›áŸáá‘á¼ášáŸáŸá–áŸ’á‘

ğŸ’¡ á§á‘á¶á ášááŸá“áŸƒá€á¶ášáŠá¶á€áŸ‹á–á¶á€áŸ’á™áŠáŸ‚á›á˜á¶á“á›á€áŸ’áááŸˆáŸá˜áŸ’á”ááŸ’áá·á‚áŸ’ášá”áŸ‹á‚áŸ’ášá¶á“áŸ‹:
"1. ABC Tech Co, CEO, á…áŸ†áá¼á› $15K á”áŸ’ášá…á¶áŸ†ááŸ‚, á€á¶ášá¢á—á·áœáŒáŸ’áá“áŸ Software
2. ááŸ’ášá¼áœá€á¶áš $100K, áŸ¦áŸ  ááŸ’á„áŸƒ, á§á”á€ášááŸ + áŠá¾á˜á‘á»á“á”á„áŸ’áœá·á›, ášáŸ†á–á¹á„ ROI áŸ¢áŸ áŸ % á€áŸ’á“á»á„ áŸ¡áŸ¢ ááŸ‚
3. á€áŸ†á–á»á„á‡á½á”á”á‰áŸ’á á¶á‡á¶á˜á½á™á€á¶ášá’áŸ’áœá¾á”á‘á”á„áŸ’á á¶á‰áœá·á“á·á™áŸ„á‚á·á“, á”ášá¶á‡áŸá™á€áŸ’á“á»á„á€á¶ášáŸáŸ’áœáŸ‚á„ášá€á˜á¼á›á“á·á’á· áŸ¡ áŠá„, á’á“á¶á‚á¶ášá‡á¶á˜á½á™ ABA
4. á”á¶á‘/á…á¶áŸ $197 áŸá˜á áŸáá»á•á›, á–áŸá‰á…á·ááŸ’áá€á¶ášá‘á¼á‘á¶ááŸ‹ ABA, ááŸ’ášáŸ€á˜ááŸ’á›á½á“áŸá˜áŸ’ášá¶á”áŸ‹á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹
5. á¢á¶á…á”áŸ’ááŸá‡áŸ’á‰á¶á…á·ááŸ’á áŸ§ á˜áŸ‰áŸ„á„/áŸá”áŸ’áá¶á áŸ, á–áŸá‰á…á·ááŸ’ááœá‚áŸ’á‚á–áŸá›á›áŸ’á„á¶á…, ááŸ’ášáŸ€á˜ááŸ’á›á½á“áŸá˜áŸ’ášá¶á”áŸ‹á€á˜áŸ’á˜áœá·á’á¸ááŸ’á›á¶áŸ†á„á€áŸ’á›á¶
6. á€áŸ†á–á»á„á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á˜á¼á›á’á“ $50K, á¢á¶á‡á¸áœá€á˜áŸ’á˜á…á»áŸ‡á”á‰áŸ’á‡á¸, á¢á“á»á›áŸ„á˜á–á“áŸ’á’, email@abc.com, 012-345-678"

ğŸ” áŠáŸ†áá¾ášá€á¶ášá‡áŸ’ášá¾áŸášá¾áŸ:
âœ… á€á¶ášá–á·á“á·ááŸ’á™á–á¶á€áŸ’á™áŸá»áŸ† (áŸ¡áŸ¢ á˜áŸ‰áŸ„á„ - á›áŸ’á”á¿á“á›á¿á“)
âœ… á€á¶ášá áŸ…á‘á¼ášáŸáŸá–áŸ’á‘áœá¶á™áá˜áŸ’á›áŸƒá‚á»ááœá»áŒáŸ’áá· (áŸ¢áŸ¤ á˜áŸ‰áŸ„á„ - á”á¾á¢á“á»á˜áŸá)
âœ… á€á¶ášá…á¼á›á”áŸ’ášá¾ VIP Program (áŸ¤áŸ¨ á˜áŸ‰áŸ„á„ á”á“áŸ’á‘á¶á”áŸ‹á–á¸á€á¶ášá¢á“á»á˜áŸá + á€á¶ášá‘á¼á‘á¶ááŸ‹)
âœ… á€á¶ášá€áŸ†áááŸ‹á–áŸá›áœá‚áŸ’á‚á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá—áŸ’á›á¶á˜áŸ—

ğŸ“Š áŸáŸ’áá·áá·á€á˜áŸ’á˜áœá·á’á¸:
ğŸ‘¥ á€áŸ†áááŸ‹á”áŸ’ášá…á¶áŸ†ááŸ‚: áŸá˜á¶á‡á·á€ VIP ${vipSpots.total} á“á¶á€áŸ‹á”áŸ‰á»ááŸ’ááŸ„áŸ‡
â° ááŸ’á„áŸƒá•á»áá€áŸ†áááŸ‹áŠá¶á€áŸ‹á–á¶á€áŸ’á™: á“áŸ…áŸá›áŸ‹ áŸ¤ ááŸ’á„áŸƒ
ğŸ”¥ á¢ááŸ’ášá¶á‡áŸ„á‚á‡áŸá™: áŸ¨áŸ©% á“áŸƒá¢áŸ’á“á€á”á‰áŸ’á…á”áŸ‹ VIP áŸá˜áŸ’ášáŸá…á”á¶á“á‚áŸ„á›áŠáŸ…áŠáŸ‚á›á”á¶á“á€áŸ†áááŸ‹
ğŸ’° á€á¶ášá€áŸ‚á›á˜áŸ’á¢á‡á¶á˜á’áŸ’á™á˜ášá”áŸáŸ‹áŸá˜á¶á‡á·á€: á›á‘áŸ’á’á•á›á”á„áŸ’á€á¾á“á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–á˜á¼á›á’á“á‚á½ášá±áŸ’á™á€ááŸ‹áŸá˜áŸ’á‚á¶á›áŸ‹
â­ á¢ááŸ’ášá¶á‚á»ááœá»áŒáŸ’áá·: áŸ§áŸ¨% á“áŸƒá–á¶á€áŸ’á™áŸá»áŸ†ááŸ’ášá¼áœá”á¶á“á¢á“á»á˜áŸá

ğŸ¯ á‡áŸ†á á¶á“á”á“áŸ’á‘á¶á”áŸ‹á”á“áŸ’á‘á¶á”áŸ‹á–á¸á€á¶ášá¢á“á»á˜áŸá:
1. á€á‰áŸ’á…á”áŸ‹áŸáŸ’áœá¶á‚á˜á“áŸ + á€á¶ášá…á¼á›á”áŸ’ášá¾áŸá á‚á˜á“áŸ
2. á€á¶ášá áŸ…á‘á¼ášáŸáŸá–áŸ’á‘áœá¶á™áá˜áŸ’á›áŸƒá˜á¼á›á’á“ (áŸ©áŸ  á“á¶á‘á¸)
3. á€á¶ášá¢á“á»áœááŸ’áá™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá…á¶á”áŸ‹á•áŸ’áá¾á˜á—áŸ’á›á¶á˜áŸ—
4. á€á¶ášáá¶á˜áŠá¶á“áœáŒáŸ’áá“á—á¶á–á”áŸ’ášá…á¶áŸ†áŸá”áŸ’áá¶á áŸ + á€á¶ášá‚á¶áŸ†á‘áŸ’áš

âš ï¸ á…áŸ†áá¶áŸ†áŸáŸ†áá¶á“áŸ‹:
â€¢ á“áŸáŸ‡á‡á¶ Advanced Capital Strategy á˜á·á“á˜áŸ‚á“á‡á¶ Basic Financial Planning á‘áŸ
â€¢ á€á¶ášá‘á¼á‘á¶ááŸ‹áá˜áŸ’ášá¼áœá±áŸ’á™á’áŸ’áœá¾á€áŸ’á“á»á„ášá™áŸˆá–áŸá› áŸ¢áŸ¤ á˜áŸ‰áŸ„á„á”á“áŸ’á‘á¶á”áŸ‹á–á¸á€á¶ášá¢á“á»á˜áŸá
â€¢ áá˜áŸ’ášá¼áœá±áŸ’á™á˜á¶á“á€á¶ášá”áŸ’ááŸá‡áŸ’á‰á¶á…á·ááŸ’áá–áŸá‰á›áŸá‰áŸá˜áŸ’ášá¶á”áŸ‹á›á‘áŸ’á’á•á›á›áŸ’á¢á”áŸ†á•á»á
â€¢ á…áŸ†ááŸáŸ‡áŠá¹á„á¢á¶á‡á¸áœá€á˜áŸ’á˜á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹ááŸ’ášá¼áœá”á¶á“áŸá“áŸ’á˜ááŸ‹

ğŸ¯ á€á¶ášáŠá¶á€áŸ‹á–á¶á€áŸ’á™áá˜áŸ’ášá¼áœá±áŸ’á™á˜áŸ’á…á¶áŸáŸ‹á¢á¶á‡á¸áœá€á˜áŸ’á˜á’áŸ’á„á“áŸ‹á’áŸ’á„ášááŸ‚á”áŸ‰á»ááŸ’ááŸ„áŸ‡áŸ”

ááŸ’ášáŸ€á˜ááŸ’á›á½á“áŠá¾á˜áŸ’á”á¸á•áŸ’á›á¶áŸáŸ‹á”áŸ’áá¼ášá™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá˜á¼á›á’á“ášá”áŸáŸ‹á¢áŸ’á“á€á á¾á™á¬á“áŸ…? áŸá¼á˜áŠá¶á€áŸ‹á–á¶á€áŸ’á™áŸá»áŸ†á›á˜áŸ’á¢á·áášá”áŸáŸ‹á¢áŸ’á“á€áá¶á„á›á¾!`;

      await sendLongMessage(
        bot,
        chatId,
        applicationMessage,
        {},
        MESSAGE_CHUNK_SIZE,
      );

      // Enhanced admin notification with comprehensive analytics
      const adminId = process.env.ADMIN_CHAT_ID;
      if (adminId) {
        try {
          const user = await User.findOne({ telegram_id: userId  });
          const adminMessage = `ğŸ† HIGH-PRIORITY VIP APPLICATION STARTED:

ğŸ‘¤ APPLICANT PROFILE:
â€¢ Name: ${msg.from.first_name || "Unknown"} (${userId})
â€¢ Username: @${msg.from.username || "no_username"}
â€¢ Language: ${msg.from.language_code || "unknown"}
â€¢ Application Time: ${new Date().toLocaleString("km-KH")}

ğŸ’° PROGRAM DETAILS:
â€¢ Type: VIP Capital Strategy ($197)
â€¢ Priority Level: HIGH (qualified prospect)
â€¢ Journey Stage: Application Started

ğŸ“Š USER ANALYTICS:
â€¢ 7-Day Program: ${progress.programCompleted ? "âœ… COMPLETED" : "âŒ NOT COMPLETED"}
â€¢ VIP Info Views: ${user?.vipInfoViewCount || 0}
â€¢ Application Attempts: ${user?.vipApplicationAttempts || 1}
â€¢ Engagement Score: ${user?.totalEngagementScore || 0}/100
â€¢ Qualification Score: ${user?.vipQualificationScore || 0}/100
â€¢ Journey Stage: ${user?.vipJourneyStage || "application_started"}
â€¢ Last Activity: ${user?.lastActive || "Unknown"}

ğŸ¯ VIP PROGRAM STATUS:
â€¢ Total Spots: ${vipSpots.total}/month
â€¢ Used Spots: ${vipSpots.used}
â€¢ Remaining: ${vipSpots.remaining()}
â€¢ Waitlist: ${vipSpots.waitlist} people
â€¢ Conversion Rate: ${vipSpots.conversionRate()}%

ğŸ“ˆ FUNNEL ANALYTICS:
â€¢ Info Views: ${analytics.vipFunnel.infoViews}
â€¢ Applications: ${analytics.vipFunnel.applications}
â€¢ Conversions: ${analytics.vipFunnel.conversions}
â€¢ Overall Conversion: ${analytics.getConversionRate()}%

â° NEXT ACTIONS:
1. âœ… User filling detailed application form
2. â³ Review application (target: 12h)
3. ğŸ“ Qualification call (if approved)
4. ğŸ’° Payment processing
5. ğŸš€ VIP onboarding

ğŸ”” ALERT: Monitor for detailed application submission!`;

          await bot.sendMessage(adminId, adminMessage);
        } catch (adminError) {
          console.error(
            "Error sending enhanced VIP admin notification:",
            adminError,
          );
        }
      }

      // Enhanced success analytics
      console.log(
        `VIP application form sent successfully to user ${userId}. Total applications: ${analytics.vipFunnel.applications}`,
      );
    },
    "VIP apply",
    { bot, chatId },
  );
}

async function offer(msg, bot) {
  if (!validateInput(msg, bot)) return;

  const userId = msg.from.id;
  const chatId = msg.chat.id;

  return executeWithErrorHandling(
    async () => {
      // Enhanced analytics tracking
      console.log(`VIP offer viewed by user ${userId} at ${new Date()}`);

      // Enhanced user tracking
      await User.findOneAndUpdate(
        { telegram_id: userId  },
        {
          lastVipOfferView: new Date(),
          last_active: new Date(),
          vipJourneyStage: "offer_viewing",
          $inc: {
            vipOfferViewCount: 1,
            totalEngagementScore: 3, // Offer view = 3 points
          },
        },
        { upsert: true },
      );

      const expiryDate = new Date(Date.now() + 48 * 60 * 60 * 1000);

      const vipCelebration = `ğŸ† á±á€á¶áŸá™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá˜á¼á›á’á“ VIP á•áŸ’áá¶á…áŸ‹á˜á»á

ğŸ’ á€á˜áŸ’á˜áœá·á’á¸á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá˜á¼á›á’á“ VIP á˜á¶á“á€áŸ†áááŸ‹
ğŸ”¥ á€á¶ášá”á‰áŸ’á…á»áŸ‡áá˜áŸ’á›áŸƒáŠáŸá’áŸ†:
- áá˜áŸ’á›áŸƒá’á˜áŸ’á˜áá¶: $497
- áá˜áŸ’á›áŸƒ Early Bird: $297
- áá˜áŸ’á›áŸƒá–á·áŸáŸáŸášá”áŸáŸ‹á¢áŸ’á“á€: $197 (á”á‰áŸ’á…á»áŸ‡ áŸ¦áŸ %!)
- á“áŸ…áŸá›áŸ‹ááŸ‚: áŸ£áŸ¦ á˜áŸ‰áŸ„á„!

ğŸš€ á áŸáá»á¢áŸ’áœá¸á”á¶á“á‡á¶áŸá á‚áŸ’ášá·á“á€á˜áŸ’á–á»á‡á¶á‡á¶á…áŸ’ášá¾á“á‡áŸ’ášá¾áŸášá¾áŸ VIP Capital Strategy:

ğŸ’° á˜áá·á€áŸ‚á›á˜áŸ’á¢á–á¸á¢áá·áá·á‡á“á“áŸ…á€á˜áŸ’á–á»á‡á¶:
ğŸ‘¤ "á”á¶á“á‡á½á™á€áŸ‚á›á˜áŸ’á¢áœá·á’á¸áŸá¶áŸáŸ’ášáŸ’ááŸáŸ’áœáŸ‚á„ášá€á˜á¼á›á“á·á’á·ášá”áŸáŸ‹ááŸ’á‰á»áŸ†" - Tech Startup, á—áŸ’á“áŸ†á–áŸá‰
ğŸ‘¤ "á™á›áŸ‹áŠá¹á„á€á¶á“áŸ‹ááŸ‚á…áŸ’á”á¶áŸáŸ‹á¢áŸ†á–á¸á”áŸ’ášá–áŸá“áŸ’á’á›áŸ†á á¼ášáŸá¶á…áŸ‹á”áŸ’ášá¶á€áŸ‹" - á˜áŸ’á…á¶áŸáŸ‹ááŸ’áŸáŸ‚áŸá„áŸ’áœá¶á€áŸ‹á—áŸ„á‡á“á¸á™áŠáŸ’á‹á¶á“, áŸáŸ€á˜ášá¶á”
ğŸ‘¤ "á”á¶á“á”á„áŸ’á€á¾áá‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„áœá·á“á·á™áŸ„á‚á·á“áŠáŸá˜á¶á“áá˜áŸ’á›áŸƒ" - áŸáŸ’áá¶á”á“á·á€ E-commerce, á”á¶ááŸ‹áŠáŸ†á”á„
ğŸ‘¤ "á”á¶á“á”á„áŸ’á€á¾áá™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá•áŸ’áá›áŸ‹á˜á¼á›á“á·á’á·ášá¹á„á˜á¶áŸ†" - Manufacturing, á€áŸ†á–á„áŸ‹á…á¶á˜

âœ… á€á‰áŸ’á…á”áŸ‹á•áŸ’á›á¶áŸáŸ‹á”áŸ’áá¼áš VIP á–áŸá‰á›áŸá‰:
ğŸ¯ á˜á¼á›áŠáŸ’á‹á¶á“á‚áŸ’ášá¹áŸ‡á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’áš:
â€¢ áœá‚áŸ’á‚á¯á€á‡á“ áŸ¡-á‘á›áŸ‹-áŸ¡ Capital Clarity (áŸ©áŸ  á“á¶á‘á¸ - áá˜áŸ’á›áŸƒ $300)
â€¢ á€á¶ášáœá¶á™áá˜áŸ’á›áŸƒá€á¶ášááŸ’ášáŸ€á˜ááŸ’á›á½á“á˜á¼á›á’á“áŠáŸá‘á¼á›áŸ†á‘á¼á›á¶á™
â€¢ á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá”á„áŸ’á€á¾á“á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–á˜á¼á›á’á“á•áŸ’á‘á¶á›áŸ‹ááŸ’á›á½á“
â€¢ á€á¶ášá‚á¶áŸ†á‘áŸ’ášá€á¶ášá¢á“á»áœááŸ’áášá™áŸˆá–áŸá› áŸ£áŸ  ááŸ’á„áŸƒ

ğŸ¯ á§á”á€ášááŸ á“á·á„á€á¶ášá…á¼á›á”áŸ’ášá¾á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹:
â€¢ á€á¶ášá…á¼á›á”áŸ’ášá¾á”ááŸ’áá¶á‰á˜á¼á›á’á“á¯á€á‡á“ (áœá·á“á·á™áŸ„á‚á·á“á€á˜áŸ’á–á»á‡á¶áŠáŸ‚á›á”á¶á“á•áŸ’á‘áŸ€á„á•áŸ’á‘á¶ááŸ‹)
â€¢ á€á¶ášá‚á¶áŸ†á‘áŸ’ášá¢á¶á‘á·á—á¶á– VIP (á†áŸ’á›á¾á™áá”á›á¿á“á‡á¶á„á’á˜áŸ’á˜áá¶ á€áŸ’á“á»á„ášá™áŸˆá–áŸá› áŸ¢-áŸ¤ á˜áŸ‰áŸ„á„)
â€¢ Dashboard áœá·á—á¶á‚á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹ (á€á¶ášáá¶á˜áŠá¶á“áŠáŸ†áá¾ášá€á¶ášá›á˜áŸ’á¢á·á)
â€¢ ášá”á¶á™á€á¶ášááŸáœáŒáŸ’áá“á—á¶á–á•áŸ’á‘á¶á›áŸ‹ááŸ’á›á½á“ (ášá”á¶á™á€á¶ášááŸ VIP á”áŸ’ášá…á¶áŸ†ááŸ‚)
â€¢ Software á”á„áŸ’á€á¾á“á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–á˜á¼á›á’á“á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹ (áá˜áŸ’á›áŸƒ $200)
â€¢ á€á¶ášá‡á¼á“áŠáŸ†áá¹á„ Deal Flow á•áŸ’áá¶á…áŸ‹á˜á»á

ğŸ¯ á€á¶ášá‚á¶áŸ†á‘áŸ’ášá”á“áŸ’á:
â€¢ á€á¶ášá áŸ…á‘á¼ášáŸáŸá–áŸ’á‘á¢á“á»áœááŸ’áá™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’áš áŸ£ áŠá„ (á€á¶ášááŸ’ášá½áá–á·á“á·ááŸ’á™á”áŸ’ášá…á¶áŸ†ááŸ‚)
â€¢ á€á¶ášá…á¼á›á”áŸ’ášá¾áŸá á‚á˜á“áŸ VIP (áŸá á‚áŸ’ášá·á“á‡áŸ„á‚á‡áŸá™ áŸ¥áŸ + á“á¶á€áŸ‹)
â€¢ á€á¶ášáá¶á˜áŠá¶á“ášá™áŸˆá–áŸá› áŸ£áŸ  ááŸ’á„áŸƒá”á“áŸ’ááŸ‚á˜ (á€á¶ášá”áŸ‚á„á…áŸ‚á€áŠáŸ†áá¾ášá€á¶ášá”áŸ’ášá…á¶áŸ†áŸá”áŸ’áá¶á áŸ)
â€¢ á€á¶ášá€á€áŸ‹á¢á¶á‘á·á—á¶á–áŸá˜áŸ’ášá¶á”áŸ‹á€á˜áŸ’á˜áœá·á’á¸á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹

ğŸ›ï¸ á›áŸ’á¢á¥áááŸ’á…áŸ„áŸ‡áŸá˜áŸ’ášá¶á”áŸ‹á˜áŸ’á…á¶áŸáŸ‹á¢á¶á‡á¸áœá€á˜áŸ’á˜á“áŸ…á€á˜áŸ’á–á»á‡á¶:
âœ… áŸáŸ’áá¶á”á“á·á€áŠáŸ‚á›áŸáŸ’áœáŸ‚á„ášá€á€á¶ášá’áŸ’áœá¾á±áŸ’á™á˜á¼á›á’á“á”áŸ’ášáŸá¾ášá¡á¾á„ (á…áŸ†áá¼á›á”áŸ’ášá…á¶áŸ†ááŸ‚ $10K+)
âœ… á¢áŸ’á“á€á”áŸ’ášáá·á”ááŸ’áá·á¢á¶á‡á¸áœá€á˜áŸ’á˜áŠáŸ‚á›ášáŸ€á”á…áŸ†á•áŸ‚á“á€á¶ášáŸáŸ’áœáŸ‚á„ášá€á˜á¼á›á“á·á’á·áŸá˜áŸ’ášá¶á”áŸ‹á€á¶ášá›á¼áá›á¶áŸáŸ‹ (á‚áŸ„á›áŠáŸ… $50K+)
âœ… áŸá á‚áŸ’ášá·á“áŠáŸ‚á›á€áŸá¶á„á”áŸ’ášá–áŸá“áŸ’á’áŠáŸ‚á›á¢á¶á…á–á„áŸ’ášá¸á€á”á¶á“ á“á·á„á¢á¶á…á”ááŸ‹á”áŸ‚á“á”á¶á“
âœ… áœá·á“á·á™áŸ„á‚á·á“áŠáŸ‚á›á…á„áŸ‹á”á„áŸ’á€á¾á“á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–á€á¶ášáŠá¶á€áŸ‹á–á„áŸ’ášá¶á™á˜á¼á›á’á“ á“á·á„á”áŸ’ášá¶á€áŸ‹á…áŸ†ááŸá‰

ğŸ¯ á‚á»ááŸá˜áŸ’á”ááŸ’áá·á”áŸ’ášá€á½áá”áŸ’ášá‡áŸ‚á„á‡á¶á€áŸ‹á›á¶á€áŸ‹á“áŸ…á€á˜áŸ’á–á»á‡á¶:
ğŸ¦ á™á›áŸ‹áŠá¹á„á‡áŸ’ášáŸ…á‡áŸ’ášáŸ‡á¢áŸ†á–á¸á”áŸ’ášá–áŸá“áŸ’á’á’á“á¶á‚á¶ášá€áŸ’á“á»á„áŸáŸ’ášá»á€ (ABA/ACLEDA/Prince Bank)
ğŸ¤ á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„á•áŸ’á‘á¶á›áŸ‹á‡á¶á˜á½á™á”ááŸ’áá¶á‰áœá·á“á·á™áŸ„á‚á·á“á€á˜áŸ’á–á»á‡á¶ á“á·á„ Venture Capital
ğŸ¢ á™á›áŸ‹áŠá¹á„áŸáŸŠá¸á‡á˜áŸ’ášáŸ…á¢áŸ†á–á¸â€‹ášá…á“á¶áŸá˜áŸ’á–áŸá“áŸ’á’á¢á¶á‡á¸áœá€á˜áŸ’á˜á€áŸ’á“á»á„áŸáŸ’ášá»á€ á“á·á„áá˜áŸ’ášá¼áœá€á¶ášá•áŸ’á›á¼áœá…áŸ’á”á¶á”áŸ‹
ğŸ’¼ á€á¶ášá…á¼á›á”áŸ’ášá¾á±á€á¶áŸá•áŸ’áá›áŸ‹á˜á¼á›á“á·á’á·á€áŸ’á“á»á„ááŸ†á”á“áŸ‹ á“á·á„á€á˜áŸ’á˜áœá·á’á¸ášáŠáŸ’á‹á¶á—á·á”á¶á›
ğŸ“ˆ á€áŸ†áááŸ‹ááŸ’ášá¶á‡áŸ„á‚á‡áŸá™áŠáŸ‚á›á”á¶á“á”á‰áŸ’á‡á¶á€áŸ‹á“áŸ…á€áŸ’á“á»á„á›á€áŸ’ááááŸ’áŒá‘á¸á•áŸ’áŸá¶ášá€á˜áŸ’á–á»á‡á¶

â° á€á¶ášá•áŸ’áá›áŸ‹á‡á¼á“á•á»áá€áŸ†áááŸ‹: áŸ£áŸ¦ á˜áŸ‰áŸ„á„ (${expiryDate.toLocaleString("km-KH")})
ğŸ‘¥ á€áŸ†áááŸ‹á”áŸ’ášá…á¶áŸ†ááŸ‚á•áŸ’áá¶á…áŸ‹á˜á»á: áŸá˜á¶á‡á·á€ VIP ${vipSpots.total} á“á¶á€áŸ‹á”áŸ‰á»ááŸ’ááŸ„áŸ‡
ğŸ”¥ á€áŸ…á¢á¸á“áŸ…áŸá›áŸ‹: ${vipSpots.remaining()} á“á¶á€áŸ‹ (${((vipSpots.remaining() / vipSpots.total) * 100).toFixed(0)}% á‘áŸ†á“áŸáš)
ğŸ“Š á˜áá·á€áŸ‚á›á˜áŸ’á¢á–á¸áŸá˜á¶á‡á·á€: áŸá˜á¶á‡á·á€ VIP á—á¶á‚á…áŸ’ášá¾á“ášá¶á™á€á¶ášááŸá–á¸áœáŒáŸ’áá“á—á¶á–á†áŸ’á–áŸ„áŸ‡á‘áŸ…ášá€á‚áŸ„á›áŠáŸ…ášá”áŸáŸ‹á–á½á€á‚áŸ

ğŸ BONUS á•áŸ’áá¶á…áŸ‹á˜á»ááŸá˜áŸ’ášá¶á”áŸ‹á€á¶ášá¢á“á»áœááŸ’áá—áŸ’á›á¶á˜áŸ—:
ğŸ’° á€á¶ášáœá¶á™áá˜áŸ’á›áŸƒá˜á¼á›á’á“á‘á¼á›áŸ†á‘á¼á›á¶á™áŠáŸ„á™á¥áá‚á·áááŸ’á›áŸƒ (áá˜áŸ’á›áŸƒ $97)
ğŸ¤ á€á¶ášááŸ‚á“á¶áŸ†á”ááŸ’áá¶á‰áœá·á“á·á™áŸ„á‚á·á“á¯á€á‡á“ (á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„áŠáŸá˜á¶á“áá˜áŸ’á›áŸƒ)
ğŸ“ á€á¶ášá…á¼á›á”áŸ’ášá¾á¢á¶á‘á·á—á¶á–á‘áŸ…á€á¶á“áŸ‹á€á˜áŸ’á˜áœá·á’á¸á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹á“á¶á–áŸá›á¢á“á¶á‚á
âš¡ á€á¶ášá‚á¶áŸ†á‘áŸ’áš VIP ášá™áŸˆá–áŸá› áŸ¦ ááŸ‚ (á‘áŸ’áœáŸáŠá„á“áŸƒášá™áŸˆá–áŸá›áŸáŸ’áá„áŸ‹áŠá¶áš)
ğŸ¯ á€á¶ášá…á¶ááŸ‹áá¶áŸ†á„á¢áŸ’á“á€á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á‡áŸ„á‚á‡áŸá™á•áŸ’á‘á¶á›áŸ‹ááŸ’á›á½á“

ğŸ’¡ á¢áŸ’áœá¸áŠáŸ‚á›á’áŸ’áœá¾á±áŸ’á™á€á˜áŸ’á˜áœá·á’á¸á“áŸáŸ‡áá»áŸá”áŸ’á›áŸ‚á€:
á˜á·á“áŠá¼á…á€á¶ášá”á„áŸ’áœá¹á€á¢á¶á‡á¸áœá€á˜áŸ’á˜á‘á¼á‘áŸ…á‘áŸ á“áŸáŸ‡á‡á¶á€á˜áŸ’á˜áœá·á’á¸á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá˜á¼á›á’á“á¯á€á‘áŸáŸáŠáŸ‚á›ááŸ’ášá¼áœá”á¶á“ášá…á“á¶á¡á¾á„á‡á¶á–á·áŸáŸáŸáŸá˜áŸ’ášá¶á”áŸ‹á”ášá·á™á¶á€á¶áŸá¢á¶á‡á¸áœá€á˜áŸ’á˜ááŸ‚á˜á½á™á‚ááŸ‹ášá”áŸáŸ‹á€á˜áŸ’á–á»á‡á¶áŸ” á™á¾á„á˜á·á“ááŸ’ášá¹á˜ááŸ‚á”á„áŸ’ášáŸ€á“á‘áŸ’ášá¹áŸáŸ’áá¸á‘áŸ - á™á¾á„á•áŸ’áá›áŸ‹á“á¼áœá‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„á‡á¶á€áŸ‹áŸáŸ’ááŸ‚á„ á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá–á·áá”áŸ’ášá¶á€áŠ á“á·á„á€áŸ’ášá”ááŸááŸ’áŒáŠáŸ‚á›á”á¶á“á”á‰áŸ’á‡á¶á€áŸ‹áŠáŸ‚á›áŠáŸ†áá¾ášá€á¶ášá“áŸ…á€áŸ’á“á»á„á‘á¸á•áŸ’áŸá¶ášá€á˜áŸ’á–á»á‡á¶áŸ”

á…á„áŸ‹á”á¶á“á–áŸááŸŒá˜á¶á“á›á˜áŸ’á¢á·áá”á“áŸ’ááŸ‚á˜? /vip_program_info
ááŸ’ášáŸ€á˜ááŸ’á›á½á“áŠá¾á˜áŸ’á”á¸á’á¶á“á¶á€áŸ…á¢á¸ášá”áŸáŸ‹á¢áŸ’á“á€á á¾á™á¬á“áŸ…? áŸášáŸáŸáš "VIP APPLY"

âš ï¸ á€á¶ášá–áŸ’ášá˜á¶á“á…á»á„á€áŸ’ášáŸ„á™: á“áŸáŸ‡á‡á¶á€á˜áŸ’á˜áœá·á’á¸áœá·á“á·á™áŸ„á‚á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹áŸá˜áŸ’ášá¶á”áŸ‹á˜áŸ’á…á¶áŸáŸ‹á¢á¶á‡á¸áœá€á˜áŸ’á˜á’áŸ’á„á“áŸ‹á’áŸ’á„ášáŠáŸ‚á›á˜á¶á“á†á“áŸ’á‘áŸˆá€áŸ’á“á»á„á€á¶ášá–á„áŸ’ášá¸á€á˜á¼á›á’á“ á“á·á„á‘áŸ†á áŸ†á¢á¶á‡á¸áœá€á˜áŸ’á˜ááŸ‚á”áŸ‰á»ááŸ’ááŸ„áŸ‡áŸ” á”á¾á¢áŸ’á“á€á˜á·á“ááŸ’ášáŸ€á˜ááŸ’á›á½á“áŸá˜áŸ’ášá¶á”áŸ‹á€á¶ášá”áŸ’ááŸá‡áŸ’á‰á¶á…á·ááŸ’á á“á·á„á€á¶ášáœá·á“á·á™áŸ„á‚á‘áŸ áŸá¼á˜á€á»áŸ†áŠá¶á€áŸ‹á–á¶á€áŸ’á™áŸ”

ğŸ”¥ áŸ£áŸ¦ á˜áŸ‰áŸ„á„á“áŸ…áŸá›áŸ‹ - á¢á“á»áœááŸ’áá¥á¡á¼áœá“áŸáŸ‡!`;

      await sendLongMessage(
        bot,
        chatId,
        vipCelebration,
        {},
        MESSAGE_CHUNK_SIZE,
      );

      // Enhanced success analytics
      console.log(`Enhanced VIP offer sent successfully to user ${userId}`);
    },
    "VIP offer",
    { bot, chatId },
  );
}

async function capitalClarity(msg, bot) {
  if (!validateInput(msg, bot)) return;

  const userId = msg.from.id;
  const chatId = msg.chat.id;
  const firstName = msg.from.first_name || "Friend";

  return executeWithErrorHandling(
    async () => {
      // Enhanced analytics tracking
      analytics.updateFunnel("capitalClarityInquiries");
      console.log(`Capital Clarity inquiry by user ${userId} at ${new Date()}`);

      // Enhanced user tracking
      await User.findOneAndUpdate(
        { telegram_id: userId  },
        {
          capitalClarityInquiry: new Date(),
          last_active: new Date(),
          vipJourneyStage: "capital_clarity_interest",
          $inc: {
            capitalClarityViews: 1,
            totalEngagementScore: 7, // High-value inquiry = 7 points
            vipQualificationScore: 15, // Premium interest
          },
        },
        { upsert: true },
      );

      const clarityResponse = `ğŸ›ï¸ áœá‚áŸ’á‚á”ááŸ’áá»áŸ‡á”ááŸ’áá¶á›á˜á¼á›á’á“ - á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá˜á¼á›á’á“á¯á€á‡á“á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹

á‡áŸ†ášá¶á”áŸá½áš ${firstName}!

ğŸ¯ áá¾áœá‚áŸ’á‚á”ááŸ’áá»áŸ‡á”ááŸ’áá¶á›á˜á¼á›á’á“á‡á¶á¢áŸ’áœá¸?

áœá‚áŸ’á‚á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá¯á€á‡á“ášá™áŸˆá–áŸá› áŸ©áŸ  á“á¶á‘á¸ áŠáŸ‚á›ááŸ’ášá¼áœá”á¶á“ášáŸ€á”á…áŸ†á¡á¾á„á‡á¶á–á·áŸáŸáŸáŠá¾á˜áŸ’á”á¸:
â€¢ áœá·á“á·á…áŸ’á†áŸá™á™áŸ‰á¶á„á…áŸ’á”á¶áŸáŸ‹á›á¶áŸáŸ‹á–á¸á€á“áŸ’á›áŸ‚á„áŠáŸ‚á›á”áŸ’ášá–áŸá“áŸ’á’á˜á¼á›á’á“ášá”áŸáŸ‹á¢áŸ’á“á€ááŸ’ášá¼áœá”á¶á“ášá¶áŸ†á„áŸáŸ’á‘áŸ‡ á›áŸá…á’áŸ’á›á¶á™ á¬áŠáŸ†áá¾ášá€á¶ášá˜á·á“á–áŸá‰á›áŸá‰
â€¢ á”á‰áŸ’á‡á¶á€áŸ‹á–á¸ášá”áŸ€á”áŠáŸ‚á›á€á·á…áŸ’á…á–áŸ’ášá˜á–áŸ’ášáŸ€á„á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“ á“á·á„á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„áœá·á“á·á™áŸ„á‚á·á“ášá”áŸáŸ‹á¢áŸ’á“á€áŠáŸ†áá¾ášá€á¶áš
â€¢ á€áŸ†áááŸ‹á¢ááŸ’ááŸá‰áŸ’á‰á¶áá‚á˜áŸ’á›á¶áá‘áŸ†á“á»á€á…á·ááŸ’á á“á·á„á á¶á“á·á—áŸá™á“áŸƒá€á¶ášáŠá¶á€áŸ‹á–á„áŸ’ášá¶á™áŠáŸ‚á›á€áŸ†á–á»á„á’áŸ’áœá¾á±áŸ’á™á¢áŸ’á“á€áá¶áá”á„áŸ‹á›á»á™
â€¢ á€áŸ†áááŸ‹áœá·á’á¸áŸá¶áŸáŸ’ášáŸ’áá€áŸ‚á›á˜áŸ’á¢á…áŸ’á”á¶áŸáŸ‹á›á¶áŸáŸ‹ á“á·á„á¢á¶á…á¢á“á»áœááŸ’áá”á¶á“á‡á¶á˜á½á™á“á¹á„áœá·á’á¸áŸá¶áŸáŸ’ášáŸ’ááŠáŸ‚á›á˜á¶á“ášá…á“á¶áŸá˜áŸ’á–áŸá“áŸ’á’
â€¢ á”á„áŸ’á€á¾áá•áŸ‚á“á‘á¸á•áŸ’á›á¼áœá”á„áŸ’á€á¾á“á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–á˜á¼á›á’á“á•áŸ’á‘á¶á›áŸ‹ááŸ’á›á½á“ášá™áŸˆá–áŸá› áŸ£áŸ -áŸ©áŸ  ááŸ’á„áŸƒ

ğŸ’° á€á¶ášáœá·á“á·á™áŸ„á‚: $197 (áá˜áŸ’á›áŸƒá’á˜áŸ’á˜áá¶: $497)
ğŸ“… á—á¶á–á¢á¶á…ášá€á”á¶á“: á˜á¶á“á€áŸ†áááŸ‹ááŸ’ášá¹á˜ áŸ¥ áœá‚áŸ’á‚/ááŸ‚ áŸá˜áŸ’ášá¶á”áŸ‹á—á¶á–á•áŸ’áá¶á…áŸ‹á˜á»á
â° á€á¶ášá€á€áŸ‹: áá˜áŸ’ášá¼áœá±áŸ’á™á€á€áŸ‹á‘á»á€á‡á¶á˜á»á“

ğŸ” á€áŸ’ášá”ááŸááŸ’áŒáœá·á—á¶á‚á‘á¼á›áŸ†á‘á¼á›á¶á™:

áŸ¡. á€á¶ášá€áŸ†áááŸ‹á‚áŸ„á›áŠáŸ… (áŸ¡áŸ¥ á“á¶á‘á¸):
â€¢ á€á¶ášá€áŸ†áááŸ‹á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“
â€¢ á€á¶ášáœá¶á™áá˜áŸ’á›áŸƒáŸáŸ’áá¶á“á—á¶á–á˜á¼á›á’á“á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“
â€¢ á€á¶ášá”á‰áŸ’á‡á¶á€áŸ‹á‚áŸ„á›áŠáŸ… á“á·á„á€á¶ášá€áŸ†áááŸ‹á€á¶á›á€áŸ†áááŸ‹

áŸ¢. á€á¶ášáœá·á—á¶á‚á˜á¼á›á’á“ (áŸ¢áŸ¥ á“á¶á‘á¸):
â€¢ á€á¶ášáœá·á—á¶á‚ášá…á“á¶áŸá˜áŸ’á–áŸá“áŸ’á’á˜á¼á›á’á“á–áŸá‰á›áŸá‰
â€¢ á€á¶ášáœá·á—á¶á‚á›áŸ†á á¼ášáŸá¶á…áŸ‹á”áŸ’ášá¶á€áŸ‹ á“á·á„á±á€á¶áŸá”á„áŸ’á€á¾á“á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–
â€¢ á€á¶ášá–á·á“á·ááŸ’á™á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–á“áŸƒá€á¶ášá”áŸ‚á„á…áŸ‚á€á˜á¼á›á’á“

áŸ£. á€á¶ášáœá¶á™áá˜áŸ’á›áŸƒá‘áŸ†á“á»á€á…á·ááŸ’á (áŸ¢áŸ  á“á¶á‘á¸):
â€¢ á€á¶ášáœá¶á™áá˜áŸ’á›áŸƒá‘áŸ†á“á»á€á…á·ááŸ’ááœá·á“á·á™áŸ„á‚á·á“
â€¢ á€á¶ášááŸ’ášá½áá–á·á“á·ááŸ’á™á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„á‡á¶á˜á½á™áŠáŸƒá‚á¼á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“ á“á·á„áŸá€áŸ’áá¶á“á»á–á›
â€¢ á€á¶ášá€áŸ†áááŸ‹á¢ááŸ’ááŸá‰áŸ’á‰á¶áá‚á˜áŸ’á›á¶áá—á¶á–á‡á¿á‡á¶á€áŸ‹

áŸ¤. á–á·á“áŸ’á‘á»ááŸ’ášáŸ€á˜ááŸ’á›á½á“á”áŸ’ášá–áŸá“áŸ’á’ (áŸ¡áŸ¥ á“á¶á‘á¸):
â€¢ á€á¶ášáœá¶á™áá˜áŸ’á›áŸƒá—á¶á–ááŸ’ášáŸ€á˜ááŸ’á›á½á“áŸá˜áŸ’ášá¶á”áŸ‹á€á¶ášášá¸á€á…á˜áŸ’ášá¾á“
â€¢ á€á¶ášáœá¶á™áá˜áŸ’á›áŸƒá áŸáŠáŸ’á‹á¶ášá…á“á¶áŸá˜áŸ’á–áŸá“áŸ’á’ á“á·á„áŠáŸ†áá¾ášá€á¶áš
â€¢ á€á¶ášá–á·á“á·ááŸ’á™á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá€á¶ááŸ‹á”á“áŸ’áá™á á¶á“á·á—áŸá™

áŸ¥. á€á¶ášá€áŸ†áááŸ‹á•áŸ‚á“á€á¶áš (áŸ¡áŸ¥ á“á¶á‘á¸):
â€¢ á•áŸ‚á“á€á¶ášá™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá‡á¶á€áŸ‹á›á¶á€áŸ‹ áŸ£áŸ /áŸ¦áŸ /áŸ©áŸ  ááŸ’á„áŸƒ
â€¢ á’á¶áá»áŸá€á˜áŸ’á˜á—á¶á–á¢á¶á‘á·á—á¶á– á“á·á„á‚áŸ„á›áŠáŸ…áŸáŸ†áá¶á“áŸ‹áŸ—
â€¢ á¢á“á»áŸá¶áŸá“áŸá”áŸ‚á„á…áŸ‚á€á’á“á’á¶á“

ğŸ‡°ğŸ‡­ á›á‘áŸ’á’á•á›á¢áá·áá·á‡á“á–á¸á€á˜áŸ’á˜áœá·á’á¸ VIP:

ğŸ‘¤ "á”á¶á“á‘á‘á½á›á˜á¼á›á“á·á’á·á¢á“á»á˜áŸáá€áŸ’á“á»á„ášá™áŸˆá–áŸá› áŸ¢ ááŸ‚"
   - á“á¶á™á€á”áŸ’ášáá·á”ááŸ’áá· Tech Startup, á—áŸ’á“áŸ†á–áŸá‰
ğŸ‘¤ "á›áŸ†á á¼ášáŸá¶á…áŸ‹á”áŸ’ášá¶á€áŸ‹ááŸ’ášá¼áœá”á¶á“ášáŸ€á”á…áŸ† á“á·á„á¢á¶á…á–áŸ’á™á¶á€ášááŸá”á¶á“á á¾á™"
   - á˜áŸ’á…á¶áŸáŸ‹ááŸ’áŸáŸ‚áŸá„áŸ’áœá¶á€áŸ‹á—áŸ„á‡á“á¸á™áŠáŸ’á‹á¶á“, áŸáŸ€á˜ášá¶á”
ğŸ‘¤ "á”á¶á“á—áŸ’á‡á¶á”áŸ‹á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„á‡á¶á˜á½á™áœá·á“á·á™áŸ„á‚á·á“áŸá€áŸ’áá¶á“á»á–á› áŸ£ á“á¶á€áŸ‹"
   - áŸáŸ’áá¶á”á“á·á€ E-commerce, á”á¶ááŸ‹áŠáŸ†á”á„
ğŸ‘¤ "á”á¶á“á€áŸá¶á„áœá·á’á¸áŸá¶áŸáŸ’ášáŸ’áá‡á¶á”áŸ’ášá–áŸá“áŸ’á’á€áŸ’á“á»á„á€á¶ášáŸáŸ’áœáŸ‚á„ášá€á˜á¼á›á’á“"
   - á“á¶á™á€á•áŸ’á“áŸ‚á€á•á›á·áá€á˜áŸ’á˜, á€áŸ†á–á„áŸ‹á…á¶á˜

ğŸ¯ á”áŸá€áŸ’áá‡á“áŠáŸá›áŸ’á¢áŸá˜áŸ’ášá¶á”áŸ‹áœá‚áŸ’á‚á”ááŸ’áá»áŸ‡á”ááŸ’áá¶á›á˜á¼á›á’á“:

âœ… áŸáŸ’áá¶á”á“á·á€áŠáŸ‚á›á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á˜á¼á›á’á“á¯á€á‡á“ ($100K+ á”áŸ’ášá…á¶áŸ†á†áŸ’á“á¶áŸ†)
âœ… á¢áŸ’á“á€á”áŸ’ášáá·á”ááŸ’áá·áŠáŸ‚á›á˜á¶á“ášá…á“á¶áŸá˜áŸ’á–áŸá“áŸ’á’á˜á¼á›á“á·á’á·áŠáŸ‚á›á˜á¶á“áŸáŸ’ášá¶á”áŸ‹ (á…áŸ†áá¼á›á”áŸ’ášá…á¶áŸ†ááŸ‚ $50K+)
âœ… á˜áŸ’á…á¶áŸáŸ‹á¢á¶á‡á¸áœá€á˜áŸ’á˜áŠáŸ‚á›ášáŸ€á”á…áŸ†á•áŸ‚á“á€á¶ášá•áŸ’áá›áŸ‹á˜á¼á›á“á·á’á·áŸá˜áŸ’ášá¶á”áŸ‹á€á¶ášá›á¼áá›á¶áŸáŸ‹á’áŸ† (á‚áŸ„á›áŠáŸ… $25K+)
âœ… áœá·á“á·á™áŸ„á‚á·á“áŠáŸ‚á›ááŸ’ášá¼áœá€á¶ášá™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášáŠá¶á€áŸ‹á–á„áŸ’ášá¶á™áŠáŸ‚á›á˜á¶á“ášá…á“á¶áŸá˜áŸ’á–áŸá“áŸ’á’
âœ… áŸá á‚áŸ’ášá·á“áŠáŸ‚á›áŸáŸ’áœáŸ‚á„ášá€á€á¶ášá”á„áŸ’á€á¾á“á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–á˜á¼á›á’á“ á“á·á„á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–

ğŸ“‹ á›á€áŸ’ááááŸ’áŒáá˜áŸ’ášá¼áœá‚á»ááœá»áŒáŸ’áá· (ááŸ’ášá¼áœá•áŸ’áá›áŸ‹á‘á¶áŸ†á„á¢áŸáŸ‹):

áŸ¡. áá½á“á¶á‘á¸ á“á·á„á€áŸ’ášá»á˜á áŸŠá»á“:
   áá½á“á¶á‘á¸á–á·áá”áŸ’ášá¶á€áŠášá”áŸáŸ‹á¢áŸ’á“á€ (áŸáŸ’áá¶á”á“á·á€/á“á¶á™á€á”áŸ’ášáá·á”ááŸ’áá·/á¢áŸ’á“á€á”áŸ’ášáá·á”ááŸ’áá·/áœá·á“á·á™áŸ„á‚á·á“)
   áˆáŸ’á˜áŸ„áŸ‡á€áŸ’ášá»á˜á áŸŠá»á“ á“á·á„áœá·áŸáŸá™á§áŸáŸ’áŸá¶á á€á˜áŸ’á˜

áŸ¢. á‘áŸ†á áŸ†á…áŸ†áá¼á›:
   á‡á½ášá…áŸ†áá¼á›á”áŸ’ášá…á¶áŸ†ááŸ‚: $5K-15K / $15K-50K / $50K-100K / $100K+
   á˜á¼á›á’á“á”áŸ’ášá…á¶áŸ†á†áŸ’á“á¶áŸ†áŠáŸ‚á›á€áŸ†á–á»á„á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„: $xxx,xxx

áŸ£. áŸáŸ’áá¶á“á—á¶á–á˜á¼á›á’á“:
   á€á¶ášá–á·á–ááŸŒá“á¶á¢áŸ†á–á¸áŸáŸ’áá¶á“á—á¶á–á˜á¼á›á’á“/á˜á¼á›á“á·á’á·á”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“
   á…áŸ†á“á½á“á‘á¹á€á”áŸ’ášá¶á€áŸ‹á‚áŸ„á›áŠáŸ…áŠáŸ‚á›ááŸ’ášá¼áœá€á¶áš: $xx,xxx
   á€á¶ášá”áŸ‰á»á“á”áŸ‰á„áŸáŸ’áœáŸ‚á„ášá€á˜á¼á›á“á·á’á·á–á¸á˜á»á“ (á‡áŸ„á‚á‡áŸá™/á”ášá¶á‡áŸá™)

áŸ¤. á”á‰áŸ’á á¶á”áŸ’ášáˆá˜á‡á¶á€áŸ‹á›á¶á€áŸ‹:
   á”á‰áŸ’á á¶á”áŸ’ášáˆá˜ášá…á“á¶áŸá˜áŸ’á–áŸá“áŸ’á’áŸáŸ†áá¶á“áŸ‹áŠáŸ‚á›á¢áŸ’á“á€á€áŸ†á–á»á„á‡á½á”á”áŸ’ášá‘áŸ‡á¥á¡á¼áœá“áŸáŸ‡
   á§á”áŸá‚áŸ’á‚á’áŸ†á”áŸ†á•á»áá€áŸ’á“á»á„á€á¶ášáŠá¶á€áŸ‹á–á„áŸ’ášá¶á™á˜á¼á›á’á“
   áá˜áŸ’ášá¼áœá€á¶ášá”á“áŸ’á‘á¶á“áŸ‹á”áŸ†á•á»áá€áŸ’á“á»á„á€á¶ášá”á„áŸ’á€á¾á“á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–á˜á¼á›á’á“

áŸ¥. á€á¶á›á€áŸ†áááŸ‹ á“á·á„á€á¶ášáœá·á“á·á™áŸ„á‚:
   á€á¶á›á€áŸ†áááŸ‹áœá·á“á·á™áŸ„á‚: áŸ£áŸ /áŸ¦áŸ /áŸ©áŸ  ááŸ’á„áŸƒ
   á€á¶ášá”á‰áŸ’á‡á¶á€áŸ‹áá¶á€á¶ášáœá·á“á·á™áŸ„á‚ $197 áŸá˜á áŸáá»á•á›
   á–áŸááŸŒá˜á¶á“á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„: á¢áŸŠá¸á˜áŸ‚á›áŠáŸ‚á›á”á¶á“á•áŸ’á‘áŸ€á„á•áŸ’á‘á¶ááŸ‹ á“á·á„á›áŸáá‘á¼ášáŸáŸá–áŸ’á‘

ğŸ‡°ğŸ‡­ á¯á€á‘áŸáŸá¢á¶á‡á¸áœá€á˜áŸ’á˜á“áŸ…á€á˜áŸ’á–á»á‡á¶:

âœ… á™á¾á„á™á›áŸ‹áŠá¹á„á‡áŸ’ášáŸ…á‡áŸ’ášáŸ‡á¢áŸ†á–á¸â€‹ášá…á“á¶áŸá˜áŸ’á–áŸá“áŸ’á’á¢á¶á‡á¸áœá€á˜áŸ’á˜á€áŸ’á“á»á„áŸáŸ’ášá»á€ á“á·á„áá˜áŸ’ášá¼áœá€á¶áš
âœ… á‡áŸ†á“á¶á‰á€áŸ’á“á»á„á€á¶ášá•áŸ’áá›áŸ‹á”áŸ’ášá¶á€áŸ‹á€á˜áŸ’á…á¸á¯á€á‡á“ á“á·á„áŠáŸ†ááŸ„áŸ‡áŸáŸ’ášá¶á™á•áŸ’áá›áŸ‹á˜á¼á›á“á·á’á·á‡áŸ†á“á½áŸ
âœ… á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„á•áŸ’á‘á¶á›áŸ‹á‡á¶á˜á½á™á”ááŸ’áá¶á‰á˜á¼á›á’á“á¯á€á‡á“á“áŸ…á€á˜áŸ’á–á»á‡á¶
âœ… ášá…á“á¶áŸá˜áŸ’á–áŸá“áŸ’á’á˜á¼á›á“á·á’á·á¯á€á‡á“áŠáŸ‚á›ááŸ’ášá¼áœá”á¶á“á€áŸ‚áŸá˜áŸ’ášá½á›áŸá˜áŸ’ášá¶á”áŸ‹á›á€áŸ’ááááŸ’áŒá‘á¸á•áŸ’áŸá¶ášá€áŸ’á“á»á„áŸáŸ’ášá»á€
âœ… á á·ášá‰áŸ’á‰áœááŸ’áá»á‡áŸ†á“á½áŸá€áŸ’ášáŸ…á–á¸á”áŸ’ášá–áŸá“áŸ’á’á’á“á¶á‚á¶ášá”áŸ’ášá–áŸƒáá¸

ğŸ’¡ á§á‘á¶á ášááŸá“áŸƒá€á¶ášáŠá¶á€áŸ‹á–á¶á€áŸ’á™á‚á»ááœá»áŒáŸ’áá·:
"áŸáŸ’áá¶á”á“á·á€, ABC Tech Solutions, á€á¶ášá¢á—á·áœáŒáŸ’áá“áŸ Software
á…áŸ†áá¼á›á”áŸ’ášá…á¶áŸ†ááŸ‚ $15K, á€áŸ†á–á»á„á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„ $100K á”áŸ’ášá…á¶áŸ†á†áŸ’á“á¶áŸ†
ááŸ’ášá¼áœá€á¶ášáŠá¾á˜á‘á»á“á–á„áŸ’ášá¸á€ $100K, á”ášá¶á‡áŸá™ áŸ¡ áŠá„á€áŸ’á“á»á„á€á¶ášáŸáŸ’áœáŸ‚á„ášá€á˜á¼á›á“á·á’á·á‡á¶á˜á½á™á’á“á¶á‚á¶ášá€áŸ’á“á»á„áŸáŸ’ášá»á€
á”á‰áŸ’á á¶á”áŸ’ášáˆá˜áŸáŸ†áá¶á“áŸ‹: á€á¶ášá’áŸ’áœá¾á”á‘á”á„áŸ’á á¶á‰áœá·á“á·á™áŸ„á‚á·á“ á“á·á„á€á¶ášá”á„áŸ’á€á¾áá—á¶á–á‡á¿á‡á¶á€áŸ‹
á€á¶á›á€áŸ†áááŸ‹ áŸ¦áŸ  ááŸ’á„áŸƒ, $197 á‡á¶á€á¶ášáœá·á“á·á™áŸ„á‚áŸá˜á áŸáá»á•á›
contact@abctech.com, 012-345-678"

ğŸ¯ á‡áŸ†á á¶á“á”á“áŸ’á‘á¶á”áŸ‹á”á“áŸ’á‘á¶á”áŸ‹á–á¸á€á¶ášáœá¶á™áá˜áŸ’á›áŸƒá‚á»ááœá»áŒáŸ’áá·:
áŸ¡. áŠá¶á€áŸ‹á–á¶á€áŸ’á™á‚á»ááœá»áŒáŸ’áá·á›á˜áŸ’á¢á·á (á›á€áŸ’ááááŸ’áŒá‘á¶áŸ†á„á¢áŸáŸ‹áá¶á„á›á¾)
áŸ¢. á€á¶ášá–á·á“á·ááŸ’á™ áŸ¢áŸ¤ á˜áŸ‰áŸ„á„ + á€á¶ášá áŸ…á‘á¼ášáŸáŸá–áŸ’á‘á•áŸ’á‘áŸ€á„á•áŸ’á‘á¶ááŸ‹á‚á»ááœá»áŒáŸ’áá·
áŸ£. á€áŸ†áááŸ‹á–áŸá›áœá‚áŸ’á‚á”ááŸ’áá»áŸ‡á”ááŸ’áá¶á›á˜á¼á›á’á“ášá™áŸˆá–áŸá› áŸ©áŸ  á“á¶á‘á¸
áŸ¤. á‘á‘á½á›á”á¶á“á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá‘á¼á›áŸ†á‘á¼á›á¶á™ + á•áŸ‚á“á€á¶ášáŸá€á˜áŸ’á˜á—á¶á–
áŸ¥. á‡á˜áŸ’ášá¾áŸ: á€á¶ášáŠáŸ†á¡á¾á„á€áŸ†ááŸ‚á‘áŸ… VIP Program (á”á¾á˜á¶á“á›á€áŸ’áááŸˆáŸá˜áŸ’á”ááŸ’áá·á‚áŸ’ášá”áŸ‹á‚áŸ’ášá¶á“áŸ‹)

âš ï¸ áá˜áŸ’ášá¼áœá€á¶ášáŸáŸ†áá¶á“áŸ‹:
â€¢ á“áŸáŸ‡á‡á¶á™á»á‘áŸ’á’áŸá¶áŸáŸ’ááŸ’ášá˜á¼á›á’á“á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹áŸá˜áŸ’ášá¶á”áŸ‹á˜áŸ’á…á¶áŸáŸ‹á¢á¶á‡á¸áœá€á˜áŸ’á˜á’áŸ’á„á“áŸ‹á’áŸ’á„ášáŠáŸ‚á›á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á˜á¼á›á’á“áŸáŸ†áá¶á“áŸ‹áŸ— ($10K+ á”áŸ’ášá…á¶áŸ†ááŸ‚)
â€¢ ááŸ’ášá¼áœááŸ‚á˜á¶á“áá˜áŸ’ášá¼áœá€á¶ášá”á„áŸ’á€á¾á“á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–á˜á¼á›á’á“á–á·áá”áŸ’ášá¶á€áŠ (á˜á·á“á˜áŸ‚á“á€á¶ášášáŸ€á”á…áŸ†á•áŸ‚á“á€á¶ášá á·ášá‰áŸ’á‰áœááŸ’áá»á˜á¼á›áŠáŸ’á‹á¶á“á‘áŸ)
â€¢ ááŸ’ášáŸ€á˜ááŸ’á›á½á“á¢á“á»áœááŸ’áá¢á“á»áŸá¶áŸá“áŸá—áŸ’á›á¶á˜áŸ—
â€¢ á”áŸ’ááŸá‡áŸ’á‰á¶á…á·ááŸ’áá…áŸ†á–áŸ„áŸ‡á€á¶ášá›á¼áá›á¶áŸáŸ‹ á“á·á„á€á¶ášá¢á—á·áœáŒáŸ’áá“áŸáœá·á‡áŸ’á‡á¶á‡á¸áœáŸˆ

ááŸ’ášáŸ€á˜ááŸ’á›á½á“áŠá¾á˜áŸ’á”á¸á”á„áŸ’á€á¾á“á”áŸ’ášáŸá·á‘áŸ’á’á—á¶á–á”áŸ’ášá–áŸá“áŸ’á’á˜á¼á›á’á“ášá”áŸáŸ‹á¢áŸ’á“á€á á¾á™á¬á“áŸ…? áŸá¼á˜á•áŸ’áá›áŸ‹á–áŸááŸŒá˜á¶á“á›á˜áŸ’á¢á·áá‚á»ááœá»áŒáŸ’áá·á‘á¶áŸ†á„á¢áŸáŸ‹áá¶á„á›á¾áŸ”

á˜á¶á“áŸáŸ†áá½áš? á‘á¶á€áŸ‹á‘á„ @Chendasum áŠáŸ„á™á•áŸ’á‘á¶á›áŸ‹áŸ”`;

      await sendLongMessage(
        bot,
        chatId,
        clarityResponse,
        {},
        MESSAGE_CHUNK_SIZE,
      );

      // Enhanced admin notification with comprehensive analytics
      const adminId = process.env.ADMIN_CHAT_ID;
      if (adminId) {
        try {
          const user = await User.findOne({ telegram_id: userId  });
          const adminMessage = `ğŸ›ï¸ HIGH-VALUE CAPITAL CLARITY INQUIRY:

ğŸ‘¤ PROSPECT PROFILE:
â€¢ Name: ${firstName} (${userId})
â€¢ Username: @${msg.from.username || "no_username"}
â€¢ Inquiry Time: ${new Date().toLocaleString("km-KH")}

ğŸ’° SERVICE INTEREST:
â€¢ Type: Private Capital Strategy Session ($197)
â€¢ Service Level: Premium/High-Touch
â€¢ Expected Value: High (capital optimization focus)

ğŸ“Š USER ANALYTICS:
â€¢ Capital Clarity Views: ${user?.capitalClarityViews || 1}
â€¢ VIP Interest Level: ${user?.vipInfoViewCount || 0} info views
â€¢ Total Engagement Score: ${user?.totalEngagementScore || 0}/100
â€¢ Qualification Score: ${user?.vipQualificationScore || 0}/100
â€¢ Journey Stage: ${user?.vipJourneyStage || "capital_clarity_interest"}
â€¢ Last Activity: ${user?.lastActive || "Unknown"}

ğŸ“ˆ CAPITAL CLARITY FUNNEL:
â€¢ Total Inquiries: ${analytics.vipFunnel.capitalClarityInquiries}
â€¢ Conversion to VIP: Tracking needed
â€¢ Premium Service Interest: HIGH

ğŸ¯ NEXT ACTIONS:
1. â³ User providing qualification information
2. ğŸ“ Qualification verification call (24h)
3. ğŸ“… Session scheduling
4. ğŸ’° Payment processing ($197)
5. ğŸš€ Capital Clarity session delivery

ğŸ”” PRIORITY ALERT: Premium service inquiry - high conversion potential!`;

          await bot.sendMessage(adminId, adminMessage);
        } catch (adminError) {
          console.error(
            "Error sending Capital Clarity admin notification:",
            adminError,
          );
        }
      }

      // Enhanced success analytics
      console.log(
        `Capital Clarity info sent successfully to user ${userId}. Total inquiries: ${analytics.vipFunnel.capitalClarityInquiries}`,
      );
    },
    "Capital Clarity",
    { bot, chatId },
  );
}

// Enhanced helper function to update VIP spots with analytics
async function updateVipSpots(action = "use", userId = null) {
  try {
    if (action === "use" && vipSpots.remaining() > 0) {
      vipSpots.used += 1;
      analytics.updateFunnel("conversions");

      if (userId) {
        await User.findOneAndUpdate(
          { telegram_id: userId  },
          {
            vipConversionDate: new Date(),
            vipJourneyStage: "converted",
            $inc: { vipQualificationScore: 50 }, // Conversion bonus
          },
        );
      }

      console.log(
        `VIP spot used. Remaining: ${vipSpots.remaining()}. Conversion rate: ${analytics.getConversionRate()}%`,
      );
    } else if (action === "reset") {
      vipSpots.reset();
      console.log(`VIP spots reset. Available: ${vipSpots.total}`);
    } else if (action === "add_waitlist") {
      vipSpots.waitlist += 1;
      console.log(`Added to waitlist. Position: ${vipSpots.waitlist}`);
    }
  } catch (error) {
    console.error("Error updating VIP spots:", error);
  }
}

// Enhanced analytics reporting function
function getVipAnalytics() {
  return {
    spots: {
      total: vipSpots.total,
      used: vipSpots.used,
      remaining: vipSpots.remaining(),
      waitlist: vipSpots.waitlist,
      conversionRate: vipSpots.conversionRate(),
    },
    funnel: analytics.vipFunnel,
    overallConversion: analytics.getConversionRate(),
  };
}

module.exports = {
  info,
  apply,
  offer,
  capitalClarity,
  updateVipSpots,
  getVipAnalytics,
};
