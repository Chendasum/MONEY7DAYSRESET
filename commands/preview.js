const User = require("../models/User");
const { sendLongMessage } = require("../utils/message-splitter"); // Import sendLongMessage utility

// Define a consistent message chunk size for splitting messages
const MESSAGE_CHUNK_SIZE = 800;

// Pre-Learning Trailer System - Comprehensive value delivery before payment
const previewCommands = {
  // Main preview hub - shows all available previews based on your original design
  async preview(msg, bot) {
    // User check is not strictly necessary here as this is free content,
    // but keeping it for consistency if future logic depends on user existence.
    // const user = await User.findOne({ telegram_id: msg.from.id  });

    const previewMessage = `🎉 ស្វាគមន៍មកកាន់ Money Master Cambodia!

💎 កម្មវិធី 7-Day Money Flow Reset™ ត្រៀមខ្លួនជាស្រេចសម្រាប់អ្នក!
🔥 ចាប់ផ្តើមដំណើរកែប្រែហិរញ្ញវត្ថុ...

🎁 **ទទួលបានភ្លាមៗ - តម្លៃធម្មតា $297 → ឥតគិតថ្លៃ!**

🎯 **ការវាយតម្លៃផ្ទាល់ខ្លួន (ត្រឹម 2 នាទី):**
/financial_quiz - ស្វែងរកពិន្ទុសុខភាពហិរញ្ញវត្ថុ + របាយការណ៍ផ្ទាល់ខ្លួន
💡 ដឹងភ្លាមថាអ្នកកំពុងបាត់បង់ $___/ខែ!

🛠️ **ឧបករណ៍គណនាវិជ្ជាជីវៈ (តម្លៃធម្មតា $127):**
/preview_tools - ឧបករណ៍ហិរញ្ញវត្ថុ 5 មុខ តម្លៃពេញ
✨ Budget Calculator + Money Leaks Finder + Emergency Fund Planner

📚 **មេរៀនសាកល្បងពេញលេញ (តម្លៃធម្មតា $94):**
/preview_lessons - សាកល្បង Day 1 & Day 2 ពេញលេញ
🎯 មេរៀនជាក់ស្តែង + ឧបករណ៍គណនា + ការតាមដាន!

🌟 **រឿងជោគជ័យពិតប្រាកដ:**
/preview_results - របាយការណ៍លុយកាក់ពិតៗ 
💰 មានគេសន្សំបាន $400-1,500 ក្នុង 30 ថ្ងៃ!

💡 **ការប្រៀបធៀបមុន-ក្រោយ:**
/preview_before_after - ជីវិតមុន VS ក្រោយ (របាយការណ៍ពិតប្រាកដ)

🚀 **ការផ្លាស់ប្តូរពិតប្រាកដ:**
/preview_transformation - ដំណើរផ្លាស់ប្តូរ 100% ពិតប្រាកដ

🎯 **ដំណើរពេញលេញ:**
/preview_journey - ដំណើរ 7 ថ្ងៃ + អ្វីដែលអ្នកនឹងបាន

🔥 **ពិសេសសម្រាប់អ្នក:**
🎁 តម្លៃធម្មតា $297 → **ឥតគិតថ្លៃ 100%!**
⏰ **ពេលកំណត់: 48 ម៉ោង (ចាប់ពីឥឡូវ)**

👇 **ចាប់ផ្តើមទទួលបានតម្លៃឥតគិតថ្លៃ:**
🎯 /financial_quiz ← ចាប់ផ្តើមនៅទីនេះ!`;

    await sendLongMessage(bot, msg.chat.id, previewMessage, { parse_mode: "Markdown" }, MESSAGE_CHUNK_SIZE);
  },

  // Preview of Day 1 content - actual valuable content sample
  async previewDay1(msg, bot) {
    const day1Preview = `📊 មេរៀនទី១ (ការមើលជាមុន): ស្វែងយល់ពីលំហូរលុយ

🎯 អ្វីដែលអ្នកនឹងរៀនក្នុងមេរៀនពេញលេញ:

💰 ការយល់ដឹងពីលុយកាក់របស់អ្នក
ថ្ងៃទី១ នឹងបង្រៀនអ្នកពីរបៀបមើលលុយរបស់អ្នកដូចជាទឹកដែលហូរ។

🔍 សំណួរសំខាន់ៗដែលអ្នកនឹងឆ្លើយបាន:
• តើលុយខ្ញុំមកពីណា? (ប្រភពចំណូល)
• តើលុយខ្ញុំទៅកន្លែងណា? (ការចំណាយ)
• តើលុយខ្ញុំនៅសល់ប៉ុន្មាន? (សមតុល្យ)

📝 សកម្មភាពដំបូងដែលអ្នកធ្វើ:
រាយការណ៍ចំណូល-ចំណាយ ៣ ថ្ងៃចុងក្រោយ

💡 គំរូកំណត់ហេតុដោយឥតគិតថ្លៃ:
\`\`\`
ថ្ងៃទី១ - ចំណូល: $___
- ចំណាយ: $___
- នៅសល់: $___

ថ្ងៃទី២ - ចំណូល: $___
- ចំណាយ: $___
- នៅសល់: $___
\`\`\`

🎯 លទ្ធផលបាន:
✓ យល់ពីលំនាំចំណាយ
✓ កំណត់បញ្ហាហិរញ្ញវត្ថុ
✓ ផែនការកែលម្អ

🚀 នេះគ្រាន់តែជាការចាប់ផ្តើម!
មេរៀនពេញលេញមាន exercises លម្អិត + ឧបករណ៍គណនា + ការតាមដាន

🎊 ចង់បានមេរៀនពេញលេញ?
/pricing - មើលកម្មវិធី ៧ ថ្ងៃពេញលេញ`;

    await sendLongMessage(bot, msg.chat.id, day1Preview, { parse_mode: "Markdown" }, MESSAGE_CHUNK_SIZE);
  },

  // Free tools showcase based on your original design
  async previewTools(msg, bot) {
    const toolsMessage = `🛠️ ឧបករណ៍ហិរញ្ញវត្ថុឥតគិតថ្លៃ

🎁 ទទួលបាន ៣ ឧបករណ៍មានតម្លៃភ្លាមៗ:

🧮 Budget Calculator Pro
✅ បញ្ចូលចំណូល និងចំណាយ
✅ ឃើញការចែកចាយលុយ
✅ ស្វែងរកកន្លែងដែលអាចសន្សំ
✅ បានគន្លឹះសន្សំលុយ
/calculate_daily - ប្រើឥឡូវ

🚨 Emergency Fund Planner
✅ គណនាតាមចំណាយប្រចាំខែ
✅ ផែនការសន្សំជាជំហាន
✅ ដឹងថាត្រូវសន្សំប៉ុន្មានក្នុងមួយខែ
✅ ពេលវេលាបានគោលដៅ
/emergency_fund - ប្រើឥឡូវ

💳 Debt Elimination Strategy
✅ តាមដានបំណុលទាំងអស់
✅ យុទ្ធសាស្ត្រ Debt Snowball
✅ គណនាការប្រាក់សន្សំបាន
✅ កាលបរិច្ឆេទចេញពីបំណុល
/debt_plan - ប្រើឥឡូវ

💝 តម្លៃធម្មតា: $47 | 🎯 សម្រាប់អ្នក: ឥតគិតថ្លៃ!

✨ នេះគ្រាន់តែជាផ្នែកតូចពីកម្មវិធីពេញលេញ!
ក្នុងកម្មវិធី ៧ ថ្ងៃពេញលេញ: ឧបករណ៍គណនាលម្អិត ១២ មុខ + ការតាមដានស្វ័យប្រវត្តិ

/pricing - មើលកម្មវិធីពេញលេញ`;

    await sendLongMessage(bot, msg.chat.id, toolsMessage, { parse_mode: "Markdown" }, MESSAGE_CHUNK_SIZE);
  },

  // Success stories with enhanced social proof from your design
  async previewResults(msg, bot) {
    const resultsMessage = `🔥 ឧទាហរណ៍លទ្ធផលដែលអាចសម្រេចបាន

💰 នេះគឺជាឧទាហរណ៍លទ្ធផលដែលអ្នកអាចទទួលបាន:

👤 សុវណ្ណ, ភ្នំពេញ, អាយុ ២៩
💵 Day 2: រកឃើញ "ប្រហោងលុយលេច" $180/ខែ
💰 Day 7: មានផែនការសន្សំ $500/ខែ រួចហើយ!
📱 "ដំបូងគិតថាលុយតិច។ ឥឡូវដឹងថាមានគ្រប់គ្រាន់!"

👤 មករា, បាត់ដំបង, អាជីវករ
💳 មានបំណុល $2,200 → សន្សំបាន $850 ក្នុង ៩០ ថ្ងៃ!
🏍️ ធ្វើការ ៤ ខែ បាន ម៉ូតូថ្មី តម្លៃ $1,800
📱 "Debt Snowball របៀបនេះ ធ្វើការមែន! ឥឡូវគ្មានបំណុលហើយ!"

👤 សុផល, សៀមរាប, ម្ចាស់ហាង
🏠 ពី $0 ទៅ Down Payment ផ្ទះ $3,500 ក្នុង ៨ ខែ!
💼 អាជីវកម្មកើនឡើង ៤៥% បន្ទាប់ពី cash flow ច្បាស់
📱 "ពីមិនដឹងគ្រប់គ្រង ឥឡូវមាន confidence ទិញផ្ទះ!"

👤 ដារ៉ា, កោះកុង, គ្រូបង្រៀន
💰 Emergency Fund: $0 → $1,350 ក្នុង ៤ ខែ!
✈️ ទំនេរ family trip $800 ទៅថៃ ដោយមិនខ្វះលុយ
📱 "ពីមុនខ្លាចចំណាយ ឥឡូវមានសុវត្ថិភាព ១០០%!"

📊 លទ្ធផលដែលអ្នកអាចសម្រេចបាន:
🎯 រកឃើញកន្លែងលុយលេចក្នុង ៤៨ ម៉ោង
💰 ចាប់ផ្តើមសន្សំបានក្នុង សប្តាហ៍ទី ១
🏦 បង្កើត Emergency Fund ផ្ទាល់ខ្លួន
💼 មានចំណេះដឹងគ្រប់គ្រងលុយកាក់

💵 លុយកាក់ពិតៗបានទទួល:
• រកឃើញលុយលេច: $120-320/ខែ (Day 1-3)
• សន្សំបានអប្បបរមា: $400-1,200/ខែ
• Emergency Fund: $600-2,000 ក្នុង ៣-៦ ខែ
• កំណើនចំណូល: ២៥-៦៥% ក្នុង ១ ឆ្នាំ

⏰ ចង់ជាអ្នកបន្ទាប់ក្នុង ៧ ថ្ងៃ?
💡 ចាប់ផ្តើមដោយ /financial_quiz ដើម្បីដឹងពីស្ថានភាពឥឡូវ!

ចូលរួមកម្មវិធីពេញលេញ: /pricing`;

    await sendLongMessage(bot, msg.chat.id, resultsMessage, { parse_mode: "Markdown" }, MESSAGE_CHUNK_SIZE);
  },

  // Complete 7-day journey overview
  async previewJourney(msg, bot) {
    const journeyMessage = `🎯 ដំណើរ ៧ ថ្ងៃពេញលេញ

🗓️ ផែនទីដំណើរការផ្លាស់ប្តូរជីវិតហិរញ្ញវត្ថុ:

📊 ថ្ងៃទី ១: Money Flow Discovery
🎯 រកឃើញលំហូរលុយពិតប្រាកដ
⏱️ រយៈពេល: ៣០ នាទី
✨ លទ្ធផល: យល់ដឹងពីស្ថានភាពហិរញ្ញវត្ថុ

💸 ថ្ងៃទី ២: Money Leaks Detection
🎯 រកកន្លែងលុយលេចនិងការខ្ជះខ្ជាយ
⏱️ រយៈពេល: ២៥ នាទី
✨ លទ្ធផល: កាត់បន្ថយចំណាយមិនចាំបាច់

🏦 ថ្ងៃទី ៣: Financial System Setup
🎯 បង្កើតប្រព័ន្ធគ្រប់គ្រងលុយកាក់
⏱️ រយៈពេល: ៤០ នាទី
✨ លទ្ធផល: មានប្រព័ន្ធតាមដានច្បាស់លាស់

💰 ថ្ងៃទី ៤: Income & Cost Mapping
🎯 គណនានិងកែលម្អចំណូល-ចំណាយ
⏱️ រយៈពេល: ៣៥ នាទី
✨ លទ្ធផល: ផែនការបង្កើនចំណូល

📈 ថ្ងៃទី ៥: Growth vs Survival Mode
🎯 ផ្លាស់ប្តូរពី "រស់រាន" ទៅ "រីកចម្រើន"
⏱️ រយៈពេល: ៤៥ នាទី
✨ លទ្ធផល: យុទ្ធសាស្ត្របង្កើនទ្រព្យ

🎯 ថ្ងៃទី ៦: Action Planning
🎯 បង្កើតផែនការពិតប្រាកដ
⏱️ រយៈពេល: ៥០ នាទី
✨ លទ្ធផល: គោលដៅច្បាស់លាស់

🏆 ថ្ងៃទី ៧: New Financial Life
🎯 បញ្ចប់និងចាប់ផ្តើមថ្មី
⏱️ រយៈពេល: ៣០ នាទី
✨ លទ្ធផល: ជីវិតហិរញ្ញវត្ថុថ្មី

🎊 សរុបអ្វីដែលអ្នកទទួលបាន:
✓ ចំណេះដឹងហិរញ្ញវត្ថុជាក់ស្តែង
✓ ឧបករណ៍គណនា ១២ មុខ
✓ ការតាមដានស្វ័យប្រវត្តិ
✓ ជំនួយផ្ទាល់ពីអ្នកជំនាញ
✓ សហគមន៍មនុស្សដូចគ្នា

🚨 LAUNCH SPECIAL: តែ $24 (ធម្មតា $47)
💰 អ្នកសន្សំបាន $23 + ROI ១០០០%+
🔥 កូដ: LAUNCH50 - តែ ២០០ កន្លែង!

/pricing - ចាប់ផ្តើមថ្ងៃនេះ`;

    await sendLongMessage(bot, msg.chat.id, journeyMessage, { parse_mode: "Markdown" }, MESSAGE_CHUNK_SIZE);
  },

  // Before/After scenarios with specific examples
  async previewBeforeAfter(msg, bot) {
    const beforeAfterMessage = `⚡ មុន VS ក្រោយ ៧ ថ្ងៃ: ការផ្លាស់ប្តូរគួរឱ្យភ្ញាក់ផ្អើល!

🔴 មុនចូលរួម vs 🟢 ក្រោយ ៧ ថ្ងៃ (ពិតប្រាកដ ១០០%)

👤 សុវណ្ណ, អ្នកលក់ បាយ, ភ្នំពេញ:
🔴 មុន: "បាត់លុយ $240/ខែ មិនដឹងទៅណា, ព្រួយបារម្ភរាល់ថ្ងៃ"
🟢 Day 7: "រកឃើញប្រហោង ៨ កន្លែង! សន្សំបាន $380/ខែ, គេបានម៉ូតូថ្មី!"

👤 រដ្ឋា, បុគ្គលិកធនាគារ, បាត់ដំបង:
🔴 មុន: "បំណុល $2,100, ខ្លាចអស់លុយចុងខែ, stress រហូត"
🟢 Day 7: "មានផែនការសងបំណុល ៩ ខែ, Emergency Fund $150 ចាប់ផ្តើមហើយ!"

👤 ម៉ាលី, ម្ចាស់ហាងកាហ្វេ, សៀមរាប:
🔴 មុន: "ចំណូល $800 តែនៅសល់តិចបំផុត, មិនដឹងប្រាក់ចំណេញ"
🟢 Day 7: "ដឹងច្បាស់ថាចំណេញ $520/ខែ, កំពុងរៀបចំបើកសាខាទី ២!"

👤 ពុទ្ធា, Freelancer, កោះកុង:
🔴 មុន: "ចំណូល $900 តែអត់ស្គាល់ថាណាចំណាយច្រើន"
🟢 Day 7: "រកឃើញ subscription មិនប្រើ $85/ខែ + បង្កើតប្រព័ន្ធតាមដាន!"

📊 ការផ្លាស់ប្តូរក្នុង ៧ ថ្ងៃ (លទ្ធផលជាមធ្យម):

💰 ការសន្សំ:
🔴 មុន: 0-5% ចំណូល → 🟢 ក្រោយ: 18-28% ចំណូល

🧠 ចំណេះដឹង:
🔴 មុន: "មិនដឹងលុយទៅណា" → 🟢 ក្រោយ: "ដឹងគ្រប់ចំណុច $1"

😰 អារម្មណ៍:
🔴 មុន: ព្រួយបារម្ភ, stress → 🟢 ក្រោយ: ទំនុកចិត្ត, មានទិសដៅ

🎯 ផែនការ:
🔴 មុន: "រស់ថ្ងៃម្តង" → 🟢 ក្រោយ: ផែនការ ៦-២៤ ខែ

⏰ តើអ្នកស្រេកដើម្បីផ្លាស់ប្តូរក្នុង ៧ ថ្ងៃទេ?
💡 ចាប់ផ្តើមដោយ /financial_quiz ដើម្បីដឹងទីតាំងឥឡូវ!

/pricing - ទទួលការផ្លាស់ប្តូរពេញលេញ`;

    await sendLongMessage(bot, msg.chat.id, beforeAfterMessage, {
      parse_mode: "Markdown",
    }, MESSAGE_CHUNK_SIZE);
  },

  // Transformation stories and mindset changes
  async previewTransformation(msg, bot) {
    const transformationMessage = `🔥 ការផ្លាស់ប្តូរជីវិតដែលអាចកើតឡើង

⚡ ឧទាហរណ៍ការផ្លាស់ប្តូរដែលអ្នកអាចទទួលបានក្នុង ៧ ថ្ងៃ:

🎯 រឿងរ៉ាវទី ១: ពីដួលរលំ ទៅ ជោគជ័យ
👤 លីណា, អ្នកលក់បន្លែ, ភ្នំពេញ, អាយុ ២៨
💸 មុន: ចំណូល $380/ខែ, បាត់លុយ $120/ខែ មិនដឹងទៅណា
💰 ក្រោយ ៧ ថ្ងៃ: រកឃើញប្រហោងលុយលេច ៦ កន្លែង!
🚀 ក្រោយ ៦ ខែ: បើកហាងកាហ្វេ, ចំណូល $1,350/ខែ
📱 "Day 2 រកឃើញលុយលេច $95/ខែ។ Day 7 ដឹងច្បាស់ថាអាចធ្វើអាជីវកម្ម!"

🏠 រឿងរ៉ាវទី ២: ពីគ្មានផ្ទះ ទៅ ម្ចាស់ផ្ទះ
👤 ចន្ទ្រា, បុគ្គលិកធនាគារ, បាត់ដំបង, អាយុ ៣២
😰 មុន: រស់នៅជួល, គ្មានលុយសន្សំ, "មិនដែលគិតថាអាចទិញផ្ទះ"
💡 ក្រោយ ៧ ថ្ងៃ: មានផែនការសន្សំច្បាស់, Emergency Fund ចាប់ផ្តើម!
🏡 ក្រោយ ១៨ ខែ: Down Payment $9,500, ទិញផ្ទះរួច!
📱 "កម្មវិធីនេះបង្រៀនថាលុយតិចក៏អាចទិញផ្ទះបាន ប្រសិនបើគ្រប់គ្រងល្អ!"

💪 រឿងរ៉ាវទី ៣: ពីបំណុលច្រើន ទៅ លុយបានច្រើន
👤 ពុទ្ធា, Freelancer, សៀមរាប, អាយុ ២៦
📉 មុន: បំណុល $3,800, stress ជារៀងរាល់ថ្ងៃ, "ខ្លាចទូរស័ព្ទរោទ៍"
⚡ ក្រោយ ៧ ថ្ងៃ: មានផែនការ Debt Snowball ច្បាស់!
💼 ក្រោយ ១០ ខែ: គ្មានបំណុល + វិនិយោគ $600/ខែ
📱 "Day 4 ដឹងថាចំណូលអាចគ្រប់ បំណុលអាចអស់។ ថ្ងៃនេះសុទ្ធតែសុខ!"

✨ រឿងរ៉ាវទី ៤: ពីមិនមានទំនុកចិត្ត ទៅ មានថាមពល
👤 សុភា, និស្សិត-ធ្វើការបន្ត, កំពត, អាយុ ២៤
😔 មុន: "មិនដឹងគ្រប់គ្រងលុយ, ខ្លាចចំណាយ, អាស្រ័យឪពុកម្តាយ"
🔥 ក្រោយ ៧ ថ្ងៃ: "ដឹងច្បាស់ថាលុយទៅណា, មានទំនុកចិត្តចំណាយ!"
🎯 ក្រោយ ៨ ខែ: រស់នៅផ្ទាល់ខ្លួន + សន្សំ $280/ខែ
📱 "ពីមុនដឹងតែចំណាយ ឥឡូវដឹងតែគ្រប់គ្រង។ អត្មានយួន!"

📊 ការផ្លាស់ប្តូរពេញលេញ:

💰 ផ្នែកហិរញ្ញវត្ថុដែលអ្នកអាចសម្រេច:
• រកឃើញលុយលេច ក្នុង ៤៨ ម៉ោង
• ចាប់ផ្តើមសន្សំបានក្នុង សប្តាហ៍ទី ១
• បង្កើត Emergency Fund ផ្ទាល់ខ្លួន
• មានចំណេះដឹងវិនិយោគមូលដ្ឋាន

😊 ផ្នែកចិត្ត:
• ពីភ័យខ្លាច → ទៅទំនុកចិត្ត
• ពី stress → ទៅស្ងប់ស្ងាត់
• ពីអាស្រ័យ → ទៅឯករាជ្យ
• ពីគ្មានទិសដៅ → ទៅមានគោលដៅ

🚀 តើអ្នកចង់ជារឿងរ៉ាវបន្ទាប់ក្នុង ៧ ថ្ងៃទេ?
💡 ចាប់ផ្តើមដោយ /financial_quiz ឥឡូវ!

/pricing - ចូលរួមកម្មវិធីពេញលេញ`;

    await sendLongMessage(bot, msg.chat.id, transformationMessage, {
      parse_mode: "Markdown",
    }, MESSAGE_CHUNK_SIZE);
  },

  // Preview lessons showcase from your original design
  async previewLessons(msg, bot) {
    const lessonsMessage = `📚 មេរៀនសាកល្បងពិសេស

🎓 ទទួលបានមេរៀនពេញលេញឥតគិតថ្លៃ:

🎯 មេរៀនទី ០: ការកំណត់គោលដៅ ⭐
⏱️ រយៈពេល: ១០ នាទី | 📄 រួមបញ្ចូល: ៣ Worksheets
🎯 រៀនកំណត់គោលដៅតាម SMART method

📋 នេះជាអ្វីដែលអ្នកនឹងរៀន:
• វិធីកំណត់គោលដៅ SMART
• ការបែងចែកគោលដៅរយៈពេលខ្លី និងវែង
• របៀបធ្វើ action plan ជាក់ស្តែង
• កំហុសធម្មតាដែលត្រូវជៀសវាង

🎁 រួមបញ្ចូល:
✅ Goal Setting Worksheet
✅ Monthly Progress Tracker
✅ ឧទាហរណ៍ពីជីវិតពិត
✅ Checklist ការអនុវត្ត

🚨 មេរៀនទី ១: Emergency Fund ជាអ្វី?
⏱️ រយៈពេល: ៨ នាទី | 🧮 Calculator រួមបញ្ចូល
💰 ដឹងថាត្រូវសន្សំប៉ុន្មាន និងយ៉ាងម៉េច

📊 ស្ថិតិគួរឱ្យភ័យ:
• ៦៨% កម្ពុជាមិនអាចរកលុយ $400 ក្នុងពេលបន្ទាន់
• ២៥% ត្រូវកម្ចីពេលមានបញ្ហាសុខភាព
• ៤០% ដាច់ការងារមិនមានលុយគ្រប់ ១ ខែ

✅ ការរៀននេះរួមបញ្ចូល:
• របៀបគណនាទំហំ Emergency Fund
• កន្លែងណាដាក់លុយអាសន្ន
• ពេលណាប្រើ Emergency Fund
• វិធីបង្កើនលុយអាសន្នលឿន

🌟 នេះគ្រាន់តែ ២/៣០ មេរៀនតែប៉ុណ្ណោះ!

💭 មេរៀនពេញលេញមានគុណភាពបែបនេះទាំងអស់!

🔥 មើលកម្មវិធីពេញលេញ: /pricing`;

    await sendLongMessage(bot, msg.chat.id, lessonsMessage, { parse_mode: "Markdown" }, MESSAGE_CHUNK_SIZE);
  },
};

module.exports = previewCommands;
